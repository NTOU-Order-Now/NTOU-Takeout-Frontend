var U=r=>{throw TypeError(r)};var k=(r,e,s)=>e.has(r)||U("Cannot "+s);var i=(r,e,s)=>(k(r,e,"read from private field"),s?s.call(r):e.get(r)),y=(r,e,s)=>e.has(r)?U("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,s),c=(r,e,s,t)=>(k(r,e,"write to private field"),t?t.call(r,s):e.set(r,s),s),f=(r,e,s)=>(k(r,e,"access private method"),s);import{ak as J,al as P,am as K,ac as G,u as N,an as T,ao as V,r as w,ap as X,aq as Y,ar as Z,as as $,at as D,au as F,av as W,aw as ee}from"./index-y4Fp-v16.js";function _(r,e){return r.filter(s=>!e.includes(s))}function se(r,e,s){const t=r.slice(0);return t[e]=s,t}var E,p,v,Q,d,R,S,q,a,B,H,M,L,A,j,te=(j=class extends J{constructor(e,s,t){super();y(this,a);y(this,E);y(this,p);y(this,v);y(this,Q);y(this,d);y(this,R);y(this,S);y(this,q);c(this,E,e),c(this,Q,t),c(this,v,[]),c(this,d,[]),c(this,p,[]),this.setQueries(s)}onSubscribe(){this.listeners.size===1&&i(this,d).forEach(e=>{e.subscribe(s=>{f(this,a,L).call(this,e,s)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,i(this,d).forEach(e=>{e.destroy()})}setQueries(e,s,t){c(this,v,e),c(this,Q,s),P.batch(()=>{const n=i(this,d),o=f(this,a,M).call(this,i(this,v));o.forEach(h=>h.observer.setOptions(h.defaultedQueryOptions,t));const u=o.map(h=>h.observer),b=u.map(h=>h.getCurrentResult()),g=u.some((h,C)=>h!==n[C]);n.length===u.length&&!g||(c(this,d,u),c(this,p,b),this.hasListeners()&&(_(n,u).forEach(h=>{h.destroy()}),_(u,n).forEach(h=>{h.subscribe(C=>{f(this,a,L).call(this,h,C)})}),f(this,a,A).call(this)))})}getCurrentResult(){return i(this,p)}getQueries(){return i(this,d).map(e=>e.getCurrentQuery())}getObservers(){return i(this,d)}getOptimisticResult(e,s){const n=f(this,a,M).call(this,e).map(o=>o.observer.getOptimisticResult(o.defaultedQueryOptions));return[n,o=>f(this,a,H).call(this,o??n,s),()=>f(this,a,B).call(this,n,e)]}},E=new WeakMap,p=new WeakMap,v=new WeakMap,Q=new WeakMap,d=new WeakMap,R=new WeakMap,S=new WeakMap,q=new WeakMap,a=new WeakSet,B=function(e,s){const t=f(this,a,M).call(this,s);return t.map((n,o)=>{const u=e[o];return n.defaultedQueryOptions.notifyOnChangeProps?u:n.observer.trackResult(u,b=>{t.forEach(g=>{g.observer.trackProp(b)})})})},H=function(e,s){return s?((!i(this,R)||i(this,p)!==i(this,q)||s!==i(this,S))&&(c(this,S,s),c(this,q,i(this,p)),c(this,R,K(i(this,R),s(e)))),i(this,R)):e},M=function(e){const s=new Map(i(this,d).map(n=>[n.options.queryHash,n])),t=[];return e.forEach(n=>{const o=i(this,E).defaultQueryOptions(n),u=s.get(o.queryHash);u?t.push({defaultedQueryOptions:o,observer:u}):t.push({defaultedQueryOptions:o,observer:new G(i(this,E),o)})}),t},L=function(e,s){const t=i(this,d).indexOf(e);t!==-1&&(c(this,p,se(i(this,p),t,s)),f(this,a,A).call(this))},A=function(){var e;if(this.hasListeners()){const s=i(this,R),t=f(this,a,H).call(this,f(this,a,B).call(this,i(this,p),i(this,v)),(e=i(this,Q))==null?void 0:e.combine);s!==t&&P.batch(()=>{this.listeners.forEach(n=>{n(i(this,p))})})}},j);function ue({queries:r,...e},s){const t=N(),n=T(),o=V(),u=w.useMemo(()=>r.map(l=>{const m=t.defaultQueryOptions(l);return m._optimisticResults=n?"isRestoring":"optimistic",m}),[r,t,n]);u.forEach(l=>{X(l),Y(l,o)}),Z(o);const[b]=w.useState(()=>new te(t,u,e)),[g,h,C]=b.getOptimisticResult(u,e.combine);w.useSyncExternalStore(w.useCallback(l=>n?$:b.subscribe(P.batchCalls(l)),[b,n]),()=>b.getCurrentResult(),()=>b.getCurrentResult()),w.useEffect(()=>{b.setQueries(u,e,{listeners:!1})},[u,e,b]);const z=g.some((l,m)=>D(u[m],l))?g.flatMap((l,m)=>{const O=u[m];if(O){const I=new G(t,O);if(D(O,l))return F(O,I,o);W(l,n)&&F(O,I,o)}return[]}):[];if(z.length>0)throw Promise.all(z);const x=g.find((l,m)=>{const O=u[m];return O&&ee({result:l,errorResetBoundary:o,throwOnError:O.throwOnError,query:t.getQueryCache().get(O.queryHash)})});if(x!=null&&x.error)throw x.error;return h(C())}export{ue as u};

import{j as e,P as h,c as q,a as F,d as R,e as O,r as w,L as z,f as V,g as D}from"./index-CE72tMC1.js";import{F as p,a as _,b as A,c as H,d as Q,e as U,g as Z}from"./index-CH8BJtdp.js";import{u as $}from"./useSystemContext-DDEc2vid.js";import{u as G}from"./sidebarStore-Bxix2vxo.js";import{S as J}from"./Sidebar-Z3vgfT-6.js";import{u as W,a as X}from"./index-CB3EHOZz.js";import{u as Y}from"./merchantStore-Dlv3aSqP.js";import{b as ee}from"./blur-C-ZNR74U.js";import"./themeStore-5Em6ob-4.js";const te=()=>{const{cartCount:t,refetchCart:s}=$();return t===void 0&&s(),console.debug("CartIcon cartCount:",t),e.jsxs("div",{className:"relative inline-flex items-center right-2 top-1",children:[e.jsx(p,{icon:_,className:"text-xl"}),t>0&&e.jsx("span",{className:"absolute -top-2 -right-2 flex items-center justify-center min-w-[18px] h-[18px] text-xs bg-red-500 text-white rounded-full px-1",children:t})]})},L=({title:t,onLeftClick:s=()=>{}})=>{const o=q(),n=F.get("authToken"),u=R(i=>i.user),c=()=>{n&&u!==void 0&&u.role==="CUSTOMER"?o("/cart"):o("/auth/login")};return e.jsxs("header",{className:"fixed z-30  top-0 left-0 w-full flex justify-between items-center bg-white shadow-md transition-shadow duration-300 ease-in-out p-2 font-notoTC",children:[e.jsx("div",{className:"text-xl cursor-pointer",onClick:s,children:e.jsx(p,{icon:A})}),e.jsx("h1",{className:"font-noto font-bold text-2xl m-0",children:e.jsx("a",{href:"/Order-Now-Frontend/",children:t})}),e.jsx("div",{className:"text-xl cursor-pointer",onClick:c,children:e.jsx(te,{})})]})};L.propTypes={title:h.string,leftIcon:h.object,rightIcon:h.object,onLeftClick:h.func,onRightClick:h.func};const l=O(t=>({selectedSortBy:localStorage.getItem("selectedSortBy"),selectedSortDir:localStorage.getItem("selectedSortDir"),selectedKeyword:localStorage.getItem("selectedKeyword"),isSubmitted:!0,showSelectionBar:!1,setSelectedKeyword:s=>t({selectedKeyword:s}),setSelectedSortBy:s=>t({selectedSortBy:s}),setSelectedSortDir:s=>t({selectedSortDir:s}),setIsSubmitted:s=>t({isSubmitted:s}),setShowSelectionBar:s=>t({showSelectionBar:s})})),se=()=>{const t=l(a=>a.setShowSelectionBar),s=l(a=>a.selectedSortBy),o=l(a=>a.selectedSortDir),n=l(a=>a.selectedKeyword),u=l(a=>a.setSelectedSortBy),c=l(a=>a.setSelectedSortDir),i=l(a=>a.setSelectedKeyword),d=l(a=>a.setIsSubmitted);w.useEffect(()=>{localStorage.setItem("selectedSortBy",s),localStorage.setItem("selectedSortDir",o),localStorage.setItem("selectedKeyword",n)},[s,o,n]);const b=()=>{const a=document.getElementById("inputKeyword").value;i(a),d(!0),t(!1)},x=a=>{u(s===a?"":a)},f=a=>{c(o===a?"":a)};return e.jsx("div",{className:"font-notoTC w-[361px] max-w-[800px] rounded-xl bg-white border-gray-700 mt-2 p-4 animate-slide-down",children:e.jsxs("div",{className:"flex justify-around w-full",children:[e.jsxs("div",{className:"flex flex-col w-[40%]",children:[e.jsx("p",{className:"text-xl",children:"篩選"}),e.jsxs("label",{className:"mt-2 flex justify-between items-center cursor-pointer",children:["評價 (預設)",e.jsx("input",{type:"radio",checked:s==="rating",onChange:()=>x("rating"),onClick:()=>x("rating"),className:"appearance-none w-4 h-4 border-2 border-black rounded-full checked:bg-blue-500 checked:border-blue-500",name:"sortBy"})]}),e.jsxs("label",{className:"mt-2 flex justify-between items-center cursor-pointer",children:["平均花費",e.jsx("input",{type:"radio",checked:s==="averageSpend",onChange:()=>x("averageSpend"),onClick:()=>x("averageSpend"),className:"appearance-none w-4 h-4 border-2 border-black rounded-full checked:bg-blue-500 checked:border-blue-500",name:"sortBy"})]})]}),e.jsxs("div",{className:"flex flex-col w-[40%]",children:[e.jsx("p",{className:"text-xl",children:"排序"}),e.jsxs("label",{className:"mt-2 flex justify-between items-center cursor-pointer",children:["由高到低 (預設)",e.jsx("input",{type:"radio",checked:o==="desc",onChange:()=>f("desc"),onClick:()=>f("desc"),className:"appearance-none w-4 h-4 border-2 border-black rounded-full checked:bg-blue-500 checked:border-blue-500",name:"sortDir"})]}),e.jsxs("label",{className:"mt-2 flex justify-between items-center cursor-pointer",children:["由低到高",e.jsx("input",{type:"radio",checked:o==="asc",onChange:()=>f("asc"),onClick:()=>f("asc"),className:"appearance-none w-4 h-4 border-2 border-black rounded-full checked:bg-blue-500 checked:border-blue-500",name:"sortDir"})]}),e.jsx("div",{className:"mt-2 flex justify-end items-center cursor-pointer",onClick:b,children:e.jsx("div",{className:"border-2 rounded-xl border-black w-[50%] flex justify-around items-center py-1",children:e.jsx("span",{children:"確認"})})})]})]})})},re=()=>{const t=l(r=>r.showSelectionBar),s=l(r=>r.setShowSelectionBar),o=l(r=>r.selectedSortBy),n=l(r=>r.selectedSortDir),u=l(r=>r.selectedKeyword),c=l(r=>r.setSelectedSortBy),i=l(r=>r.setSelectedSortDir),d=l(r=>r.setSelectedKeyword),b=l(r=>r.setIsSubmitted);w.useEffect(()=>{const r=localStorage.getItem("selectedSortBy"),y=localStorage.getItem("selectedSortDir"),S=localStorage.getItem("selectedKeyword");r==="null"&&localStorage.setItem("selectedSortBy","rating"),y==="null"&&localStorage.setItem("selectedSortDir","desc"),S==="null"&&localStorage.setItem("selectedKeyword",""),c(r||"rating"),i(y||"desc"),d(S||"")},[d,c,i]),w.useEffect(()=>{localStorage.setItem("selectedSortBy",o),localStorage.setItem("selectedSortDir",n),localStorage.setItem("selectedKeyword",u)},[o,n,u]);const[x,f]=w.useState(localStorage.getItem("selectedKeyword")),a=()=>{s(!t)},j=()=>{const r=document.getElementById("inputKeyword").value;f(r),d(r),b(!0),s(!1)},I=r=>{r.key==="Enter"&&(j(),r.preventDefault())};return e.jsxs("div",{className:"font-notoTC flex flex-col items-center w-full max-w-[800px] my-5 mx-auto box-border",children:[e.jsxs("div",{className:"flex items-center justify-between w-full px-2",children:[e.jsxs("div",{className:"relative text-2xl flex items-center justify-center cursor-pointer",onClick:a,children:[e.jsx(p,{icon:H}),!(o===""&&n==="")&&e.jsx("div",{className:"absolute -top-[17px] right-[-4px] z-45",children:e.jsx(p,{icon:Q,className:"w-3",style:{color:"#ff0a0a"}})})]}),e.jsx("input",{type:"text",className:"flex-grow mx-2 border-b-2 border-black outline-none text-lg py-1",placeholder:"想吃什麼...",id:"inputKeyword",onKeyDown:I,value:x,onChange:r=>f(r.target.value)}),e.jsx("div",{className:"text-2xl flex items-center justify-center cursor-pointer",onClick:j,children:e.jsx(p,{icon:U})})]}),t&&e.jsx(se,{})]})};var M={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var s="fas",o="star",n=576,u=512,c=[11088,61446],i="f005",d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z";t.definition={prefix:s,iconName:o,icon:[n,u,c,i,d]},t.faStar=t.definition,t.prefix=s,t.iconName=o,t.width=n,t.height=u,t.ligatures=c,t.unicode=i,t.svgPathData=d,t.aliases=c})(M);const E=t=>{const{id:s,name:o,averageSpend:n,rating:u,picture:c,reviews:i}=t,d=Math.floor(Math.random()*30)+1;return e.jsx(z,{to:`/menu/${s}`,children:e.jsxs("div",{className:"font-notoTC relative  h-60 bg-white rounded-2xl overflow-hidden shadow-lg transition-transform hover:scale-105",children:[e.jsx("div",{className:"object-cover w-full h-full",children:e.jsx(ee.LazyLoadImage,{src:c,alt:"Store Image",className:"relative w-full h-[65%] object-cover",wrapperClassName:"object-cover w-full h-full"})}),e.jsxs("div",{className:"absolute  h-[87px] w-full top-[154px] border-gray-300 mt-1 ",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"absolute h-[22px] left-[12px] top-[9px] text-black font-bold text-lg leading-5 line-clamp-3 overflow-hidden break-words transition",children:o}),e.jsxs("div",{className:"absolute h-[12px] left-[12px] top-[32px] text-gray-500 font-semibold text-xs leading-[12px]",children:["距離您約 ",d," 公里"]})]}),e.jsxs("div",{className:"flex flex-row w-full relative justify-between -bottom-14 items-center mx-4 ",children:[e.jsxs("div",{className:" text-green-700 font-bold text-xs leading-[12px]",children:["平均花費約 ",Math.floor(n)," 元"]}),e.jsxs("div",{className:"flex flex-row mr-7",children:[e.jsx(p,{icon:M.faStar,style:{color:"#FFD43B"},className:"h-[0.80em] w-[0.80em] "}),e.jsxs("span",{className:"font-medium text-[13px] leading-[15px] text-gray-600 mb-[-1px]",children:[u.toFixed(1)," (",i.length,")"]})]})]})]})]})},s)};E.propTypes={id:h.string.isRequired,name:h.string.isRequired,averageSpend:h.number.isRequired,rating:h.number.isRequired,picture:h.string.isRequired,reviews:h.array.isRequired};const K=()=>e.jsxs("div",{className:`relative w-[90vw] h-[241px] m-2 bg-white/30 backdrop-blur-sm border-2 
                    border-gray-300 rounded-2xl overflow-hidden animate-pulse`,children:[e.jsx("div",{className:"w-full h-[65%] bg-gray-200/50"}),e.jsxs("div",{className:"box-border absolute w-[90vw] h-[87px] left-0 top-[154px] border-t-2 border-gray-300",children:[e.jsx("div",{className:"absolute h-[22px] left-[12px] top-[9px]",children:e.jsx("div",{className:"h-5 bg-gray-200/50 rounded w-40"})}),e.jsx("div",{className:"absolute h-[12px] left-[12px] top-[32px]",children:e.jsx("div",{className:"h-3 bg-gray-200/50 rounded w-32"})}),e.jsx("div",{className:"absolute h-[12px] left-[12px] top-[57px]",children:e.jsx("div",{className:"h-3 bg-gray-200/50 rounded w-36"})}),e.jsx("div",{className:"absolute w-[75px] h-[20px] right-[3px] bottom-[11px] flex items-center",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-200/50 rounded-full"}),e.jsx("div",{className:"h-4 bg-gray-200/50 rounded w-16"})]})})]})]});function ae(){const{addMerchants:t}=Y(),s=4,o=l(g=>g.isSubmitted),n=l(g=>g.setIsSubmitted),{ref:u,inView:c}=W({rootMargin:"500px"});localStorage.getItem("selectedSortBy")==="null"&&localStorage.setItem("selectedSortBy","rating"),localStorage.getItem("selectedSortDir")==="null"&&localStorage.setItem("selectedSortDir","desc"),localStorage.getItem("selectedKeyword")==="null"&&localStorage.setItem("selectedKeyword","");const i=localStorage.getItem("selectedSortBy"),d=localStorage.getItem("selectedSortDir"),b=localStorage.getItem("selectedKeyword"),{data:x,isLoading:f,isError:a,error:j,isSuccess:I}=V({queryKey:["MerchantIdList",i,d,b],queryFn:async()=>{const g=await D.getStoreIdList({sortBy:i,sortDir:d,keyword:b});return n(!1),g.data},enabled:o&&!!i&&!!d,staleTime:1e3*60*10}),{data:r,fetchNextPage:y,hasNextPage:S,isFetchingNextPage:k,isLoading:P,isError:B,error:T}=X({queryKey:["merchants",x],queryFn:async({pageParam:g})=>{const m=g*s,v=m+s,N=x.slice(m,v);if(N.length===0)return[];const C=await D.getMerchantsByIdList(N);return t(C.data),C.data},initialPageParam:0,getNextPageParam:(g,m)=>{const v=m.length,N=(x==null?void 0:x.length)||0;if(v*s<N)return v},enabled:I});return w.useEffect(()=>{c&&!k&&S&&y()},[c,k,S,y]),a||B?e.jsxs("div",{className:"text-center",children:[a&&j.message,B&&T.message]}):f||P?e.jsx("div",{className:"flex justify-center items-center mt-4 fa-2x",children:e.jsx(p,{icon:Z,spinPulse:!0})}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 lg:p-20 p-8",children:[r==null?void 0:r.pages.map(g=>g.map(m=>e.jsx(w.Suspense,{fallback:e.jsx(K,{}),children:e.jsx(E,{id:m.id,name:m.name,averageSpend:m.averageSpend,rating:m.rating,reviews:m.reviewIdList,picture:m.picture,className:"w-full h-full bg-white border border-gray-300 rounded-xl shadow-lg"})},m.id))),e.jsx("div",{ref:u,children:S&&e.jsx("div",{className:"flex justify-center items-center mt-4 fa-2x",children:e.jsx(K,{})})})]})}function he(){const t=G(s=>s.toggleSidebar);return e.jsxs("div",{children:[e.jsx(L,{title:"OrderNow",onLeftClick:t,className:"fixed top-0"}),e.jsx("div",{className:"py-5"}),e.jsx(J,{}),e.jsx(re,{}),e.jsx(ae,{})]})}export{he as default};

import{d as A,j as e,P as x,c as P,a as I,r as w,L as Q,e as U,g as z}from"./index-BVyBSOmJ.js";import{F as b}from"./index.es-BJrB9fUl.js";import{c as _,d as F,e as Z,g as G,h as J,i as W,j as X,k as Y,l as ee,m as te,n as se,o as re,p as oe,q as le,b as ae}from"./index-CuE17EBt.js";import{u as q}from"./userInfoStore-DXg8e0fP.js";import{c as L}from"./react-CxkCoJ2v.js";import{u as ne,a as ie}from"./index-CyOl1Hh9.js";import{u as ce}from"./merchantStore-CZdUOu35.js";import{b as de}from"./blur-DLlne5MJ.js";const xe=()=>{const{cartCount:t}=A();return console.debug("CartIcon cartCount:",t),e.jsxs("div",{className:"relative inline-flex items-center right-2 top-1",children:[e.jsx(b,{icon:_,className:"text-xl"}),t>0&&e.jsx("span",{className:"absolute -top-2 -right-2 flex items-center justify-center min-w-[18px] h-[18px] text-xs bg-red-500 text-white rounded-full px-1",children:t})]})},O=({title:t,onLeftClick:s=()=>{}})=>{const l=P(),n=I.get("authToken"),{isLogin:c}=q(),a=()=>{n&&c==!0?l("/cart"):l("/auth/login")};return e.jsxs("header",{className:"fixed z-30  top-0 left-0 w-full flex justify-between items-center bg-white shadow-md transition-shadow duration-300 ease-in-out p-2 font-notoTC",children:[e.jsx("div",{className:"text-xl cursor-pointer",onClick:s,children:e.jsx(b,{icon:F})}),e.jsx("h1",{className:"font-noto font-bold text-2xl m-0",children:e.jsx("a",{href:"/Order-Now-Frontend",children:t})}),e.jsx("div",{className:"text-xl cursor-pointer",onClick:a,children:e.jsx(xe,{})})]})};O.propTypes={title:x.string,leftIcon:x.object,rightIcon:x.object,onLeftClick:x.func,onRightClick:x.func};const B=L(t=>({isOpen:!1,toggleSidebar:()=>t(s=>({isOpen:!s.isOpen})),closeSidebar:()=>t({isOpen:!1})})),D=L(t=>({themeMode:"light",toggleTheme:()=>t(s=>({themeMode:s.themeMode==="light"?"dark":"light"})),setThemeLight:()=>t({themeMode:"light"}),setThemeDark:()=>t({themeMode:"dark"})})),S=({icon:t,text:s,textStyle:l,iconSize:n,iconColor:c,onClick:a,style:m})=>{const d=f=>{console.log({text:s}),f.stopPropagation(),a&&a(),console.log(D.getState().themeMode)};return e.jsxs("button",{className:`flex items-center text-left  ${m}`,onClick:d,children:[t&&e.jsx(b,{icon:t,size:n,style:{color:c},className:"px-2 w-10"}),s&&e.jsx("span",{className:`font-notoTC font-bold  ${l}`,children:s})]})};S.propTypes={icon:x.object,text:x.string,textStyle:x.string,iconSize:x.string,iconColor:x.string,onClick:x.func,style:x.string};const me=()=>{const t=B(r=>r.isOpen),s=D(r=>r.themeMode),l=D(r=>r.toggleTheme),n=B(r=>r.closeSidebar),c=P(),a=I.get("authToken"),{id:m,isLogin:d,clearUserInfo:f}=q();let u="登入";a&&d==!0?u=m:u="登入";const h=()=>{I.remove("authToken"),f(),c("/auth/login"),n()};return e.jsxs(e.Fragment,{children:[t&&e.jsx("div",{className:`fixed top-0 z-40 min-h-screen min-w-full transition-all duration-300  ${t?"bg-slate-950 bg-opacity-20":""}`,onClick:n}),e.jsxs("div",{className:`font-notoTC z-50 fixed inset-y-0 left-0 bg-white w-3/5 shadow-lg border-zinc-400 border-r-1 max-w-md ${t?"translate-x-0":"-translate-x-full"} transition-transform duration-300 min-w-48`,children:[e.jsxs("div",{className:"p-4 overflow-hidden",children:[e.jsx(S,{text:u,textStyle:"text-2xl px-2 ",icon:F,iconSize:"2xl",iconColor:"#053766",style:"py-8",onClick:()=>{t&&!a&&(c("/auth/login"),n())}}),e.jsx(S,{text:"商家瀏覽紀錄",icon:Z,iconSize:"lg",iconColor:"#053766",style:"px-4 py-4"}),e.jsx(S,{text:"歷史訂單紀錄",icon:G,iconSize:"lg",iconColor:"#053766",style:"px-4 py-4"}),e.jsx(S,{text:"收藏店家",icon:J,iconSize:"lg",iconColor:"#053766",style:"px-4 py-4"}),e.jsx(S,{text:"問題回報",icon:W,iconSize:"lg",iconColor:"#606162",style:"pt-8 pb-4 px-4"}),e.jsx(S,{text:"語言",icon:X,iconSize:"lg",iconColor:"#606162",style:"px-4 py-4"}),e.jsx(S,{text:"設定",icon:Y,iconSize:"lg",iconColor:"#606162",style:"px-4 py-4"})]}),e.jsxs("div",{className:"px-4 absolute bottom-0 left-0 right-2 flex justify-between",children:[a&&e.jsx(S,{text:"登出",icon:ee,iconSize:"lg",iconColor:"#606162",onClick:h}),e.jsx(S,{icon:s=="light"?te:se,text:"切換主題",textStyle:"w-0  invisible",iconSize:"lg",iconColor:s=="light"?"#606162":"#FFD43B",onClick:l})]})]})]})},i=L(t=>({selectedSortBy:localStorage.getItem("selectedSortBy"),selectedSortDir:localStorage.getItem("selectedSortDir"),selectedKeyword:localStorage.getItem("selectedKeyword"),isSubmitted:!0,showSelectionBar:!1,setSelectedKeyword:s=>t({selectedKeyword:s}),setSelectedSortBy:s=>t({selectedSortBy:s}),setSelectedSortDir:s=>t({selectedSortDir:s}),setIsSubmitted:s=>t({isSubmitted:s}),setShowSelectionBar:s=>t({showSelectionBar:s})})),ue=()=>{const t=i(r=>r.setShowSelectionBar),s=i(r=>r.selectedSortBy),l=i(r=>r.selectedSortDir),n=i(r=>r.selectedKeyword),c=i(r=>r.setSelectedSortBy),a=i(r=>r.setSelectedSortDir),m=i(r=>r.setSelectedKeyword),d=i(r=>r.setIsSubmitted);w.useEffect(()=>{localStorage.setItem("selectedSortBy",s),localStorage.setItem("selectedSortDir",l),localStorage.setItem("selectedKeyword",n)},[s,l,n]);const f=()=>{const r=document.getElementById("inputKeyword").value;m(r),d(!0),t(!1)},u=r=>{c(s===r?"":r)},h=r=>{a(l===r?"":r)};return e.jsx("div",{className:"font-notoTC w-[361px] max-w-[800px] rounded-xl bg-white border-gray-700 mt-2 p-4 animate-slide-down",children:e.jsxs("div",{className:"flex justify-around w-full",children:[e.jsxs("div",{className:"flex flex-col w-[40%]",children:[e.jsx("p",{className:"text-xl",children:"篩選"}),e.jsxs("label",{className:"mt-2 flex justify-between items-center cursor-pointer",children:["評價 (預設)",e.jsx("input",{type:"radio",checked:s==="rating",onChange:()=>u("rating"),onClick:()=>u("rating"),className:"appearance-none w-4 h-4 border-2 border-black rounded-full checked:bg-blue-500 checked:border-blue-500",name:"sortBy"})]}),e.jsxs("label",{className:"mt-2 flex justify-between items-center cursor-pointer",children:["平均花費",e.jsx("input",{type:"radio",checked:s==="averageSpend",onChange:()=>u("averageSpend"),onClick:()=>u("averageSpend"),className:"appearance-none w-4 h-4 border-2 border-black rounded-full checked:bg-blue-500 checked:border-blue-500",name:"sortBy"})]})]}),e.jsxs("div",{className:"flex flex-col w-[40%]",children:[e.jsx("p",{className:"text-xl",children:"排序"}),e.jsxs("label",{className:"mt-2 flex justify-between items-center cursor-pointer",children:["由高到低 (預設)",e.jsx("input",{type:"radio",checked:l==="desc",onChange:()=>h("desc"),onClick:()=>h("desc"),className:"appearance-none w-4 h-4 border-2 border-black rounded-full checked:bg-blue-500 checked:border-blue-500",name:"sortDir"})]}),e.jsxs("label",{className:"mt-2 flex justify-between items-center cursor-pointer",children:["由低到高",e.jsx("input",{type:"radio",checked:l==="asc",onChange:()=>h("asc"),onClick:()=>h("asc"),className:"appearance-none w-4 h-4 border-2 border-black rounded-full checked:bg-blue-500 checked:border-blue-500",name:"sortDir"})]}),e.jsx("div",{className:"mt-2 flex justify-end items-center cursor-pointer",onClick:f,children:e.jsx("div",{className:"border-2 rounded-xl border-black w-[50%] flex justify-around items-center py-1",children:e.jsx("span",{children:"確認"})})})]})]})})},ge=()=>{const t=i(o=>o.showSelectionBar),s=i(o=>o.setShowSelectionBar),l=i(o=>o.selectedSortBy),n=i(o=>o.selectedSortDir),c=i(o=>o.selectedKeyword),a=i(o=>o.setSelectedSortBy),m=i(o=>o.setSelectedSortDir),d=i(o=>o.setSelectedKeyword),f=i(o=>o.setIsSubmitted);w.useEffect(()=>{const o=localStorage.getItem("selectedSortBy"),j=localStorage.getItem("selectedSortDir"),y=localStorage.getItem("selectedKeyword");o=="null"&&localStorage.setItem("selectedSortBy","rating"),j=="null"&&localStorage.setItem("selectedSortDir","desc"),y=="null"&&localStorage.setItem("selectedKeyword",""),a(o||"rating"),m(j||"desc"),d(y||"")},[d,a,m]),w.useEffect(()=>{localStorage.setItem("selectedSortBy",l),localStorage.setItem("selectedSortDir",n),localStorage.setItem("selectedKeyword",c)},[l,n,c]);const[u,h]=w.useState(localStorage.getItem("selectedKeyword")),r=()=>{s(!t)},v=()=>{const o=document.getElementById("inputKeyword").value;h(o),d(o),f(!0),s(!1)},C=o=>{o.key==="Enter"&&(v(),o.preventDefault())};return e.jsxs("div",{className:"font-notoTC flex flex-col items-center w-full max-w-[800px] my-5 mx-auto box-border",children:[e.jsxs("div",{className:"flex items-center justify-between w-full px-2",children:[e.jsxs("div",{className:"relative text-2xl flex items-center justify-center cursor-pointer",onClick:r,children:[e.jsx(b,{icon:re}),!(l===""&&n==="")&&e.jsx("div",{className:"absolute -top-[17px] right-[-4px] z-45",children:e.jsx(b,{icon:oe,className:"w-3",style:{color:"#ff0a0a"}})})]}),e.jsx("input",{type:"text",className:"flex-grow mx-2 border-b-2 border-black outline-none text-lg py-1",placeholder:"想吃什麼...",id:"inputKeyword",onKeyDown:C,value:u,onChange:o=>h(o.target.value)}),e.jsx("div",{className:"text-2xl flex items-center justify-center cursor-pointer",onClick:v,children:e.jsx(b,{icon:le})})]}),t&&e.jsx(ue,{})]})};var R={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var s="fas",l="star",n=576,c=512,a=[11088,61446],m="f005",d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z";t.definition={prefix:s,iconName:l,icon:[n,c,a,m,d]},t.faStar=t.definition,t.prefix=s,t.iconName=l,t.width=n,t.height=c,t.ligatures=a,t.unicode=m,t.svgPathData=d,t.aliases=a})(R);const $=t=>{const{id:s,name:l,averageSpend:n,rating:c,picture:a,reviews:m}=t,d=Math.floor(Math.random()*30)+1;return e.jsx(Q,{to:`/menu/${s}`,children:e.jsxs("div",{className:`font-notoTC relative w-[90vw] h-[241px] m-2 bg-white border-2
                        border-gray-300 rounded-2xl overflow-hidden`,children:[e.jsx("div",{className:"object-cover w-full h-full",children:e.jsx(de.LazyLoadImage,{src:a,alt:"Store Image",className:"relative w-full h-[65%] object-cover",wrapperClassName:"object-cover w-full h-full"})}),e.jsxs("div",{className:"box-border absolute w-[90vw] h-[87px] left-0 top-[154px] border-t-2 border-gray-300",children:[e.jsx("div",{className:"absolute h-[22px] left-[12px] top-[9px] text-black font-bold text-lg leading-5",children:l}),e.jsxs("div",{className:"absolute h-[12px] left-[12px] top-[32px] text-gray-500 font-semibold text-xs leading-[12px]",children:["距離您約 ",d," 公里"]}),e.jsxs("div",{className:"absolute h-[12px] left-[12px] top-[57px] text-green-700 font-bold text-xs leading-[12px]",children:["平均花費約 ",n," 元"]}),e.jsx("div",{className:"absolute w-[75px] h-[20px] right-[3px] bottom-[11px] flex items-center",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(b,{icon:R.faStar,style:{color:"#FFD43B"},className:"h-[0.80em] w-[0.80em] mr-[1px]"}),e.jsxs("span",{className:"font-medium text-[13px] leading-[15px] text-gray-600 mb-[-1px]",children:[c," (",m.length,")"]})]})})]})]})},s)};$.propTypes={id:x.string.isRequired,name:x.string.isRequired,averageSpend:x.number.isRequired,rating:x.number.isRequired,picture:x.string.isRequired,reviews:x.array.isRequired};const E=()=>e.jsxs("div",{className:`relative w-[90vw] h-[241px] m-2 bg-white/30 backdrop-blur-sm border-2 
                    border-gray-300 rounded-2xl overflow-hidden animate-pulse`,children:[e.jsx("div",{className:"w-full h-[65%] bg-gray-200/50"}),e.jsxs("div",{className:"box-border absolute w-[90vw] h-[87px] left-0 top-[154px] border-t-2 border-gray-300",children:[e.jsx("div",{className:"absolute h-[22px] left-[12px] top-[9px]",children:e.jsx("div",{className:"h-5 bg-gray-200/50 rounded w-40"})}),e.jsx("div",{className:"absolute h-[12px] left-[12px] top-[32px]",children:e.jsx("div",{className:"h-3 bg-gray-200/50 rounded w-32"})}),e.jsx("div",{className:"absolute h-[12px] left-[12px] top-[57px]",children:e.jsx("div",{className:"h-3 bg-gray-200/50 rounded w-36"})}),e.jsx("div",{className:"absolute w-[75px] h-[20px] right-[3px] bottom-[11px] flex items-center",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-200/50 rounded-full"}),e.jsx("div",{className:"h-4 bg-gray-200/50 rounded w-16"})]})})]})]});function he(){const{addMerchants:t}=ce(),s=4,l=i(p=>p.isSubmitted),n=i(p=>p.setIsSubmitted),{ref:c,inView:a}=ne({rootMargin:"100px"});localStorage.getItem("selectedSortBy")==="null"&&localStorage.setItem("selectedSortBy","rating"),localStorage.getItem("selectedSortDir")==="null"&&localStorage.setItem("selectedSortDir","desc"),localStorage.getItem("selectedKeyword")==="null"&&localStorage.setItem("selectedKeyword","");const m=localStorage.getItem("selectedSortBy"),d=localStorage.getItem("selectedSortDir"),f=localStorage.getItem("selectedKeyword"),{data:u,isLoading:h,isError:r,error:v,isSuccess:C}=U({queryKey:["MerchantIdList",m,d,f],queryFn:async()=>{const p=await z.getStoreIdList({sortBy:m,sortDir:d,keyword:f});return n(!1),p.data},enabled:l,staleTime:1e3*60*10}),{data:o,fetchNextPage:j,hasNextPage:y,isFetchingNextPage:K,isLoading:H,isError:M,error:V}=ie({queryKey:["merchants",u],queryFn:async({pageParam:p})=>{const g=p*s,N=g+s,k=u.slice(g,N);if(k.length===0)return[];const T=await z.getMerchantsByIdList(k);return t(T.data),T.data},initialPageParam:0,getNextPageParam:(p,g)=>{const N=g.length,k=(u==null?void 0:u.length)||0;if(N*s<k)return N},enabled:C});return w.useEffect(()=>{a&&!K&&y&&j()},[a,K,y,j]),r||M?e.jsxs("div",{className:"text-center",children:[r&&v.message,M&&V.message]}):h||H?e.jsx("div",{className:"flex justify-center items-center mt-4 fa-2x",children:e.jsx(b,{icon:ae,spinPulse:!0})}):e.jsxs("div",{className:"-z-40-50 min-h-screen flex flex-col items-center space-y-6 py-5",children:[o==null?void 0:o.pages.map(p=>p.map(g=>e.jsx(w.Suspense,{fallback:e.jsx(E,{}),children:e.jsx($,{id:g.id,name:g.name,averageSpend:g.averageSpend,rating:g.rating,reviews:g.reviewIdList,picture:g.picture,className:"w-[70vw] h-[200px] bg-white border border-gray-300 rounded-xl shadow-lg"})},g.id))),e.jsx("div",{ref:c,children:y&&e.jsx("div",{className:"flex justify-center items-center mt-4 fa-2x",children:e.jsx(E,{})})})]})}function Ne(){const t=B(s=>s.toggleSidebar);return e.jsxs("div",{children:[e.jsx(O,{title:"OrderNow 馬上點",onLeftClick:t,className:"fixed top-0"}),e.jsx("div",{className:"py-5"}),e.jsx(me,{}),e.jsx(ge,{}),e.jsx(he,{})]})}export{Ne as default};

import{y as N,A as I,b as S,n as D,P,j as t,d as A,r as h,V as g,t as k,a5 as L,F as R,K as q}from"./index-Bimiw5Kl.js";import{u as M}from"./orderStore-CzwJo3bq.js";import{U as T,O,E as U}from"./EstimatedTime-CJ9pzvCl.js";import{H as K}from"./Header-OQr4foe_.js";import{u as B}from"./useSystemContext-BllPy76F.js";import{u as G}from"./useCategoryQueries-BRBlbY59.js";import{C as Q}from"./CartItemCard-ByHBYUNB.js";import"./useQueries-C0P2TKHk.js";import"./blur-CDRptKMI.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=N("MessageSquareDiff",[["path",{d:"m5 19-2 2V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2",key:"1xuzuj"}],["path",{d:"M9 10h6",key:"9gxzsh"}],["path",{d:"M12 7v6",key:"lw1j43"}],["path",{d:"M9 17h6",key:"r8uit2"}]]),F=async(e,o)=>{try{return(await I.post("/v1/stores/query",e,{signal:o})).data}catch(s){if(S.isCancel(s)){console.debug("Get store data request cancelled");return}else console.error("Get store data error:",s);throw s}},H=e=>{const{data:o,isLoading:s,isError:n,refetch:i}=D({queryKey:["store",e],queryFn:({signal:l})=>F(e,l),enabled:e.length>0,staleTime:9e5});return{storeData:o,isLoading:s,isError:n,refetch:i}},p=({setShowAddReview:e})=>t.jsxs("footer",{className:"cursor-pointer font-notoTC  bg-orange-500 p-4 text-center text-white flex justify-center items-center",onClick:()=>e(!0),children:[t.jsx("span",{className:"text-xl px-2 pt-1",children:t.jsx(z,{})}),t.jsx("span",{className:"text-xl font-bold mr-2",children:"撰寫評論"})]});p.propTypes={setShowAddReview:P.func.isRequired};const te=()=>{var x;const e=M(r=>r.orderData),o=A(),[s,n]=h.useState(!1),{userInfo:i}=B();if(h.useEffect(()=>{e===null&&o("/history/order")},[e,o]),e===null)return t.jsx(g,{});const l={PENDING:{text:"未接單",bgColor:"bg-stone-600"},PROCESSING:{text:"製作中",bgColor:"bg-blue-500"},COMPLETED:{text:"未取餐",bgColor:"bg-yellow-500"},PICKED_UP:{text:"已取餐",bgColor:"bg-green-500"},CANCELED:{text:"取消",bgColor:"bg-gray-300"}},d=r=>l[r]||{text:"default",bgColor:"bg-gray-200"},C=t.jsx("button",{className:`${d(e==null?void 0:e.status).bgColor} text-sm px-3 py-1 rounded-md text-white font-bold`,children:d(e==null?void 0:e.status).text}),{storeData:a,isLoading:y,isError:j}=H([e.storeId]),c=a?a[0].menuId:null,{menuCategoryList:b}=k(c),{categoryData:w}=G(b,c,i!==void 0&&c!==void 0),v=async()=>{await o(-1)},E=r=>{const m=w.flatMap(u=>u.dishes).find(u=>u.id===r);return m?m.picture:null};return y||a===void 0||j?t.jsx(g,{}):(e==null?void 0:e.status)==="PICKED_UP"&&s&&a?t.jsx(L,{storeName:(x=a[0])==null?void 0:x.name,setShowAddReview:n,storeId:e.storeId}):t.jsxs("div",{className:"flex flex-col h-screen",children:[t.jsx("div",{className:"sticky mt-[54px] z-50 shadow-sm",children:t.jsx(K,{LeftIcon:t.jsx(R,{icon:q}),title:"單號 "+e.id.slice(-5),onLeftClick:v,rightComponents:[C]})}),t.jsxs("div",{className:"flex-1 overflow-auto pb-[48px]",children:[t.jsxs("div",{className:"bg-white text-black flex-1 p-4 overflow-auto",children:[t.jsx(T,{user:e,storeData:a[0],role:i.role}),t.jsx(O,{note:e.note}),e.orderedDishes.map((r,f)=>t.jsx(Q,{dishData:r,imageUrl:E(r.dishId),showAdjustBtn:!1},f))]}),(e==null?void 0:e.status)==="PICKED_UP"?t.jsx("div",{className:"fixed bottom-0 left-0 right-0 w-full",children:t.jsx(p,{setShowAddReview:n})}):(e==null?void 0:e.status)!=="CANCELED"&&t.jsx("div",{className:"fixed bottom-0 left-0 right-0 w-full",children:t.jsx(U,{value:e.estimatedPrepTime})})]})]})};export{te as default};

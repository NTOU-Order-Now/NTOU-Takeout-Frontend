import{j as e,A as p,P as y,r as w,h as v,c as P,i as b}from"./index-C6Vrb7cb.js";import{F as i,d as u,c as g,f as C}from"./index-D5PwHk5Q.js";import{u as T,a as A}from"./index-CrIhrabM.js";const I=t=>{const{name:r,starNumber:a,date:s,description:n}=t;return e.jsxs("div",{className:"font-notoTC w-[90%] mx-auto mt-10 p-4 bg-white rounded-lg border border-gray-300",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:r}),e.jsx("span",{className:"text-gray-500 text-sm",children:s})]}),e.jsxs("div",{className:"flex items-center mt-2",children:[[...Array(a)].map((c,o)=>e.jsx(i,{icon:u,className:"text-yellow-300"},o)),[...Array(5-a)].map((c,o)=>e.jsx(i,{icon:u,className:"text-gray-300"},o))]}),e.jsx("p",{className:"mt-2 text-gray-700 leading-relaxed",children:n})]})},R=async(t,r,a)=>{try{return(await p.get(`/v1/reviews/${t}/query`,{params:{page:r,size:a}})).data}catch(s){throw console.error("Get store data error:",s),s}},E=(t,r)=>{const{data:a,fetchNextPage:s,hasNextPage:n,isFetchingNextPage:c,isLoading:o,isError:d,error:f}=T({queryKey:["reviews",t],queryFn:async({pageParam:l})=>(await R(t,l,r)).data,initialPageParam:0,getNextPageParam:l=>l.currentPage<l.totalPages?l.currentPage+1:void 0,staleTime:6e5});return{reviews:a,fetchNextPage:s,hasNextPage:n,isFetchingNextPage:c,isLoading:o,isError:d,error:f}},j=({merchantId:t})=>{const{ref:a,inView:s}=A({rootMargin:"100px"}),{reviews:n,fetchNextPage:c,hasNextPage:o,isFetchingNextPage:d,isLoading:f,isError:l,error:h}=E(t,5);return w.useEffect(()=>{s&&o&&!d&&c()},[s,o,d,c]),f?e.jsx("div",{className:"font-notoTC w-screen flex justify-center items-center mt-4 fa-2x",children:e.jsx(i,{icon:g,spinPulse:!0,className:"flex justify-center items-center"})}):e.jsxs("div",{className:"font-notoTC flex flex-col items-center ",children:[n==null?void 0:n.pages.map(N=>N.content.map(x=>e.jsx(I,{name:x.userName,starNumber:x.rating,date:x.date,description:x.comment},x.id))),e.jsx("div",{ref:a,className:"my-5"}),o?e.jsx("div",{className:"flex justify-center items-center mt-4 fa-2x",children:e.jsx(i,{icon:g,spinPulse:!0})}):"沒有更多評論"]})};j.propTypes={merchantId:y.string.isRequired};const m=t=>{const{stars:r,percentage:a,count:s}=t;return e.jsxs("div",{className:"font-notoTC items-center mt-1 flex flex-row",children:[e.jsx("div",{className:"flex",children:[...Array(5)].map((n,c)=>e.jsx(i,{icon:u,className:c<r?"text-yellow-300":"text-gray-300"},c))}),e.jsx("div",{className:"w-full mr-31 bg-gray-200 rounded-full h-2.5 mx-2",children:e.jsx("div",{className:"bg-yellow-300 h-2.5 rounded-full",style:{width:`${a}%`}})}),e.jsxs("span",{className:"text-gray-700",children:["(",s,")"]})]})},L=10,F=15,S=40,_=20,q=15,Q=2,k=3,B=8,M=4,O=3,G=()=>{const{merchantId:t}=v(),r=P(),a=()=>{r(-1)},{storeData:s,isLoading:n}=b([t]);return n?e.jsx("div",{className:"font-notoTC flex justify-center items-center mt-4 fa-2x",children:e.jsx(i,{icon:g,spinPulse:!0})}):e.jsx("div",{className:"overflow-y-auto font-notoTC fixed top-0 left-0 w-full h-full  bg-white flex flex-col justify-start items-start",children:e.jsxs("div",{className:"w-full mt-8",children:[e.jsx("div",{className:"absolute top-4 right-4",children:e.jsx("button",{className:"text-gray-500 hover:text-gray-700",onClick:a,children:e.jsx(i,{icon:C,className:"w-8 h-8"})})}),e.jsxs("div",{className:"title flex flex-col items-center",children:[e.jsxs("h2",{className:"text-xl font-bold text-black text-center",children:[s==null?void 0:s[0].name,"的評論"]}),e.jsxs("div",{className:"flex items-center mt-4 text-left",children:[e.jsx("span",{className:"text-3xl font-bold",children:Number(s==null?void 0:s[0].rating.toFixed(1))}),e.jsx(i,{icon:u,className:"text-yellow-300 ml-2 w-8 h-8"})]}),e.jsxs("div",{className:"mt-4 text-left w-3/4 max-w-md mx-5",children:[e.jsx(m,{stars:5,percentage:L,count:Q}),e.jsx(m,{stars:4,percentage:F,count:k}),e.jsx(m,{stars:3,percentage:S,count:B}),e.jsx(m,{stars:2,percentage:_,count:M}),e.jsx(m,{stars:1,percentage:q,count:O})]})]}),e.jsx(j,{merchantId:t})]})})};export{G as default};

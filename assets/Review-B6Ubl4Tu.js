import{j as e,A as y,P as N,r as p,h as w,i as v,d as b,k as P}from"./index-CLSTvJUF.js";import{F as l,c as u,d as g,f as R}from"./index-VuW7c7ad.js";import{u as T,a as F}from"./index-B7a-I0Oa.js";const A=t=>{const{name:n,starNumber:s,date:a,description:r}=t;return e.jsxs("div",{className:"font-notoTC w-[90%] mx-auto mt-10 p-4 bg-white rounded-lg border border-gray-300",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:n}),e.jsx("span",{className:"text-gray-500 text-sm",children:a})]}),e.jsxs("div",{className:"flex items-center mt-2",children:[[...Array(s)].map((c,i)=>e.jsx(l,{icon:u,className:"text-yellow-300"},i)),[...Array(5-s)].map((c,i)=>e.jsx(l,{icon:u,className:"text-gray-300"},i))]}),e.jsx("p",{className:"mt-2 text-gray-700 leading-relaxed",children:r})]})},E=async(t,n,s)=>{try{return(await y.get(`/v1/reviews/${t}/query`,{params:{page:n,size:s}})).data}catch(a){throw console.error("Get store data error:",a),a}},L=(t,n)=>{const{data:s,fetchNextPage:a,hasNextPage:r,isFetchingNextPage:c,isLoading:i,isError:m,error:d}=T({queryKey:["reviews",t],queryFn:async({pageParam:o})=>(await E(t,o,n)).data,initialPageParam:0,getNextPageParam:o=>o.currentPage<o.totalPages?o.currentPage+1:void 0,staleTime:6e5});return{reviews:s,fetchNextPage:a,hasNextPage:r,isFetchingNextPage:c,isLoading:i,isError:m,error:d}},j=({merchantId:t})=>{const{ref:s,inView:a}=F({rootMargin:"100px"}),{reviews:r,fetchNextPage:c,hasNextPage:i,isFetchingNextPage:m,isLoading:d,isError:o,error:f}=L(t,5);return p.useEffect(()=>{a&&i&&!m&&c()},[a,i,m,c]),d?e.jsx("div",{className:"font-notoTC w-screen flex justify-center items-center mt-4 fa-2x",children:e.jsx(l,{icon:g,spinPulse:!0,className:"flex justify-center items-center"})}):e.jsxs("div",{className:"font-notoTC flex flex-col items-center ",children:[r==null?void 0:r.pages.map(h=>h.content.map(x=>e.jsx(A,{name:x.userName,starNumber:x.rating,date:x.date,description:x.comment},x.id))),e.jsx("div",{ref:s,className:"my-5"}),i?e.jsx("div",{className:"flex justify-center items-center mt-4 fa-2x",children:e.jsx(l,{icon:g,spinPulse:!0})}):"沒有更多評論"]})};j.propTypes={merchantId:N.string.isRequired};const k=t=>{const{stars:n,percentage:s,count:a}=t;return e.jsxs("div",{className:"font-notoTC items-center mt-1 flex flex-row",children:[e.jsx("div",{className:"flex w-24 shrink-0",children:[...Array(5)].map((r,c)=>e.jsx(l,{icon:u,className:c<n?"text-yellow-300":"text-gray-300"},c))}),e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2.5 mx-2",children:e.jsx("div",{className:"bg-yellow-300 h-2.5 rounded-full",style:{width:`${s}%`}})}),e.jsxs("span",{className:"w-12 shrink-0 text-gray-700 text-right",children:["(",a,")"]})]})},q=async(t,n)=>{try{return(await y.get(`/v1/reviews/${t}`,{signal:n})).data}catch(s){throw console.error("Get store data error:",s),s}},I=(t,n=!0)=>{const{data:s,refetch:a,isLoading:r,isError:c}=w({queryKey:["reviewNumberData",t],queryFn:async({signal:i})=>await q(t,i),enabled:!!t&&n,refetchOnWindowFocus:!1,staleTime:60466176e13});return{reviewNumberData:s,refetch:a,isLoading:r,isError:c}},_=()=>{const{merchantId:t}=v(),n=b(),{reviewNumberData:s}=I(t),a=()=>{n(-1)},{storeData:r,isLoading:c}=P([t]);return c?e.jsx("div",{className:"font-notoTC flex justify-center items-center mt-4 fa-2x",children:e.jsx(l,{icon:g,spinPulse:!0})}):e.jsx("div",{className:"overflow-y-auto font-notoTC fixed top-0 left-0 w-full h-full  bg-white flex flex-col justify-start items-start",children:e.jsxs("div",{className:"w-full mt-8 relative",children:[e.jsxs("div",{className:"flex justify-between items-start px-4 mb-4",children:[e.jsx("div",{className:"flex-1 flex justify-center",children:e.jsxs("h2",{className:"text-xl font-bold text-black text-center max-w-[80%]",children:[r==null?void 0:r[0].name,"的評論"]})}),e.jsx("button",{className:"text-gray-500 hover:text-gray-700 ml-4 shrink-0",onClick:a,children:e.jsx(l,{icon:R,className:"w-8 h-8"})})]}),e.jsxs("div",{className:"title flex flex-col items-center",children:[e.jsxs("div",{className:"flex items-center mt-4 text-left",children:[e.jsx("span",{className:"text-3xl font-bold",children:Number(r==null?void 0:r[0].rating.toFixed(1))}),e.jsx(l,{icon:u,className:"text-yellow-300 ml-2 w-8 h-8"})]}),e.jsx("div",{className:"mt-4 text-left w-3/4 max-w-md mx-5",children:[5,4,3,2,1].map((i,m)=>{const d=s==null?void 0:s.data[m],o=s==null?void 0:s.data.reduce((h,x)=>h+x,0),f=o>0?(d/o*100).toFixed(1):0;return e.jsx(k,{stars:i,percentage:Number(f),count:d},i)})})]}),e.jsx(j,{merchantId:t})]})})};export{_ as default};

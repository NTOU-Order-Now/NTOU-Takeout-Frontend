import{e as b,c as v,j as e,P as x,d as D,a as z,f as T,g as L,r as m,L as E,A as P}from"./index-YwLf8I32.js";import{F as g,a as I,b as B}from"./index-CfLZK19C.js";import{u as q}from"./sidebarStore-DElKmWtg.js";import{S as O}from"./Sidebar-uwT-VqNn.js";import{S as R}from"./Sidebar-BoQ-QNul.js";import{B as F}from"./button-8OtV1Bi9.js";import{D as H,a as M,b as $,c as A,d as K,e as _,f as U,g as Q}from"./drawer-C_mgcgXc.js";import{u as V,a as W}from"./index-C_KH_hCv.js";import{b as Z}from"./blur-7cZasfdP.js";import{S as p}from"./skeleton-CsJyPzLY.js";import{f as G}from"./faEllipsis-CxEkbWIP.js";import"./themeStore-Dm3FEsAF.js";import"./index-BLKvTJt7.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=b("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=b("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]),Y=()=>{const{cartCount:r,refetchCart:s,userInfo:i}=v();return i&&r===void 0&&s(),e.jsxs("div",{className:"relative inline-flex items-center right-2 top-1",children:[e.jsx(g,{icon:I,className:"text-xl"}),r>0&&e.jsx("span",{className:"absolute -top-2 -right-2 flex items-center justify-center min-w-[18px] h-[18px] text-xs bg-red-500 text-white rounded-full px-1",children:r})]})},N=({title:r,onLeftClick:s=()=>{},className:i})=>{const n=D(),l=z.get("authToken"),a=T(c=>c.user),t=()=>{l&&a!==void 0&&a.role==="CUSTOMER"?n("/cart"):n("/auth/login")};return e.jsxs("header",{className:`flex justify-between bg-white shadow-md  p-2 font-notoTC ${i}`,children:[e.jsx("div",{className:"text-xl pl-2 cursor-pointer",onClick:s,children:e.jsx(g,{icon:B})}),e.jsx("h1",{className:"font-noto font-bold text-2xl m-0",children:e.jsx("a",{href:"/Order-Now-Frontend/",children:r})}),e.jsx("div",{className:"text-xl pr-2 cursor-pointer",onClick:t,children:e.jsx(Y,{})})]})};N.propTypes={title:x.string,leftIcon:x.object,rightIcon:x.object,onLeftClick:x.func,onRightClick:x.func,className:x.string};const j=L(r=>({isOpen:!1,setIsOpen:s=>r({isOpen:s}),keyword:"",setKeyword:s=>r({keyword:s}),sortBy:"rating",setSortBy:s=>r({sortBy:s}),sortDir:"desc",setSortDir:s=>r({sortDir:s})}));function ee(){const{sortBy:r,sortDir:s,setSortBy:i,setSortDir:n}=j(),[l,a]=m.useState(r),[t,c]=m.useState(s),d=f=>{a(f)},o=f=>{c(f)};return e.jsxs(H,{children:[e.jsx(M,{asChild:!0,children:e.jsx(X,{strokeWidth:2,size:18,className:"text-zinc-500"})}),e.jsxs($,{children:[e.jsxs(A,{className:"text-left",children:[e.jsx(K,{children:"篩選店家"}),e.jsx(_,{children:"預設為由評分由高至低排序"})]}),e.jsxs("div",{className:"flex justify-around w-full font-notoTC py-4",children:[e.jsxs("div",{className:"flex flex-col w-[40%]",children:[e.jsx("p",{className:"text-sm",children:"篩選根據"}),e.jsxs("label",{className:"mt-2 flex justify-between items-center cursor-pointer",children:["評價 (預設)",e.jsx("input",{type:"radio",checked:l==="rating",onChange:()=>d("rating"),className:"appearance-none w-4 h-4 border-2 border-black rounded-full checked:bg-zinc-500 checked:border-zinc-600",name:"sortBy",required:!0})]}),e.jsxs("label",{className:"mt-2 flex justify-between items-center cursor-pointer",children:["平均花費",e.jsx("input",{type:"radio",checked:l==="averageSpend",onChange:()=>d("averageSpend"),className:"appearance-none w-4 h-4 border-2 border-black rounded-full checked:bg-zinc-500 checked:border-zinc-600",name:"sortBy",required:!0})]})]}),e.jsxs("div",{className:"flex flex-col w-[40%]",children:[e.jsx("p",{className:"text-sm",children:"排序"}),e.jsxs("label",{className:"mt-2 flex justify-between items-center cursor-pointer",children:["由高到低 (預設)",e.jsx("input",{type:"radio",checked:t==="desc",onChange:()=>o("desc"),className:"appearance-none w-4 h-4 border-2 border-black rounded-full checked:bg-zinc-500 checked:border-zinc-600",name:"sortDir",required:!0})]}),e.jsxs("label",{className:"mt-2 flex justify-between items-center cursor-pointer",children:["由低到高",e.jsx("input",{type:"radio",checked:t==="asc",onChange:()=>o("asc"),className:"appearance-none w-4 h-4 border-2 border-black rounded-full checked:bg-zinc-500 checked:border-zinc-600",name:"sortDir",required:!0})]})]})]}),e.jsx(U,{className:"pt-2",children:e.jsx(Q,{asChild:!0,onClick:()=>{i(l),n(t)},children:e.jsx(F,{className:"font-notoTC",children:"確定"})})})]})]})}const re=()=>{const{isOpen:r,setIsOpen:s,setKeyword:i,keyword:n}=j(),l=()=>{console.debug("keyword:",n)},a=t=>{t.key==="Enter"&&(l(),t.preventDefault())};return e.jsx("div",{className:"font-notoTC flex flex-row items-center w-full  mt-5 px-5 ",children:e.jsxs("div",{className:"bg-zinc-100 flex flex-row items-center w-full px-3 rounded-xl shadow-md h-9",children:[e.jsx("div",{children:e.jsx(J,{strokeWidth:3,size:18,color:"#52525b"})}),e.jsx("input",{type:"text",className:"w-full mx-2 text-gray-500 outline-none text-[15px] py-1 bg-zinc-100",placeholder:"搜尋想找的店家",id:"inputKeyword",onKeyDown:a,value:n,onChange:t=>i(t.target.value)}),e.jsx("button",{className:"rounded-lg w-10 h-6 justify-center flex items-center hover:bg-zinc-300",onClick:()=>s(!r),children:e.jsx(ee,{})})]})})};var S={};(function(r){Object.defineProperty(r,"__esModule",{value:!0});var s="fas",i="star",n=576,l=512,a=[11088,61446],t="f005",c="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z";r.definition={prefix:s,iconName:i,icon:[n,l,a,t,c]},r.faStar=r.definition,r.prefix=s,r.iconName=i,r.width=n,r.height=l,r.ligatures=a,r.unicode=t,r.svgPathData=c,r.aliases=a})(S);const k=r=>{const{id:s,name:i,averageSpend:n,rating:l,picture:a}=r;return e.jsx(E,{to:`/menu/${s}`,children:e.jsxs("div",{className:"font-notoTC relative  h-60 bg-white rounded-2xl overflow-hidden shadow-lg ",children:[e.jsx("div",{className:"object-cover w-full h-full",children:e.jsx(Z.LazyLoadImage,{src:a,alt:i,effect:"blur",className:"relative w-full h-[65%] object-cover",wrapperClassName:"object-cover w-full h-full"})}),e.jsxs("div",{className:"absolute  h-[87px] w-full top-[154px] border-gray-300 mt-1 ",children:[e.jsx("div",{className:"flex flex-col",children:e.jsx("div",{className:"absolute h-[22px] left-[12px] top-[9px] text-black font-bold text-lg leading-5 line-clamp-3 overflow-hidden break-words transition",children:i})}),e.jsxs("div",{className:"flex flex-row w-full relative justify-between -bottom-14 items-center mx-4 ",children:[e.jsxs("div",{className:" text-green-700 font-bold text-xs leading-[12px]",children:["平均花費約 ",Math.floor(n)," 元"]}),e.jsxs("div",{className:"flex flex-row mr-7",children:[e.jsx(g,{icon:S.faStar,style:{color:"#FFD43B"},className:"h-[0.80em] top-0.5 relative pr-1"}),e.jsx("span",{className:"font-medium text-[13px] leading-[15px] text-gray-600 mb-[-1px]",children:l.toFixed(1)})]})]})]})]})},s)};k.propTypes={id:x.string.isRequired,name:x.string.isRequired,averageSpend:x.number.isRequired,rating:x.number.isRequired,picture:x.string.isRequired};const y=()=>e.jsxs("div",{className:"font-notoTC relative h-60 bg-white rounded-2xl overflow-hidden shadow-lg",children:[e.jsx(p,{className:"w-full h-[65%]"}),e.jsxs("div",{className:"absolute h-[87px] w-full top-[154px] border-gray-300 mt-1",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"absolute h-[22px] left-[12px] top-[9px]",children:e.jsx(p,{className:"w-48 h-5"})}),e.jsx("div",{className:"absolute h-[12px] left-[12px] top-[32px]",children:e.jsx(p,{className:"w-32 h-3"})})]}),e.jsxs("div",{className:"flex flex-row w-full relative justify-between -bottom-14 items-center mx-4",children:[e.jsx("div",{children:e.jsx(p,{className:"w-28 h-3"})}),e.jsx("div",{className:"flex items-center mr-7",children:e.jsx(p,{className:"w-12 h-3"})})]})]})]}),se=async(r,s,i,n,l)=>{try{return(await P.get("/v3/stores/search",{params:{keyword:r,sortBy:s,sortDir:i,page:n,size:l}})).data}catch(a){throw console.error("Get store data error:",a),a}},te=(r,s,i,n)=>{const{data:l,fetchNextPage:a,hasNextPage:t,isFetchingNextPage:c,isLoading:d,isError:o,error:f}=V({queryKey:["storeData",r,s,i],queryFn:async({pageParam:u})=>(await se(r,s,i,u,n)).data,initialPageParam:0,getNextPageParam:u=>u.currentPage<u.totalPages?u.currentPage+1:void 0,staleTime:6e4});return{storeData:l,fetchNextPage:a,hasNextPage:t,isFetchingNextPage:c,isLoading:d,isError:o,error:f}};function ae(){const{ref:s,inView:i}=W({rootMargin:"500px"}),{keyword:n,sortBy:l,sortDir:a}=j(),{storeData:t,fetchNextPage:c,hasNextPage:d,isFetchingNextPage:o,isLoading:f,isError:u,error:w}=te(n,l,a,5);return m.useEffect(()=>{i&&!o&&d&&c()},[i,o,d,c]),u?e.jsx("div",{className:"text-center",children:w}):f?e.jsx("div",{className:"py-2 flex items-center justify-center text-lg",children:e.jsx(g,{icon:G.faEllipsis,beatFade:!0,size:"lg",className:"mr-2"})}):(t==null?void 0:t.pages.length)===1&&(t==null?void 0:t.pages[0].content.length)===0?e.jsx("div",{className:"py-12 font-notoTC font-bold text-gray-500 flex items-center justify-center text-lg",children:"尋找不到符合篩選條件的店家"}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 lg:p-20 p-8",children:[t==null?void 0:t.pages.map(C=>C.content.map(h=>e.jsx(m.Suspense,{fallback:e.jsx(y,{}),children:e.jsx(k,{id:h.id,name:h.name,averageSpend:h.averageSpend,rating:h.rating,reviews:h.reviewIdList,picture:h.picture,className:"w-full h-full bg-white border border-gray-300 rounded-xl shadow-lg"})},h.id))),e.jsx("div",{ref:s,children:d&&o&&e.jsx(y,{})})]})}function je(){const r=q(a=>a.toggleSidebar),{userInfo:s}=v(),[i,n]=m.useState(!0),l=m.useRef(null);return m.useEffect(()=>{const a=l.current;if(!a)return;let t=0;const c=3,d=()=>{const o=a.scrollTop,f=a.scrollHeight-a.clientHeight<=o+1;if(o<0||f||o<0)return;if(o===0){n(!0),t=0;return}const u=o-t;u>c?(n(!1),t=o):u<-c&&(n(!0),t=o)};return a.addEventListener("scroll",d),()=>{a.removeEventListener("scroll",d)}},[]),e.jsxs("div",{className:"flex flex-col h-dvh w-dvw overflow-hidden",children:[e.jsx(N,{title:"OrderNow",onLeftClick:r,className:`
                fixed top-0 z-30 w-full overflow-hidden
                transition-transform duration-300 ease-in-out
                ${i?"translate-y-0":"-translate-y-full "}
            `}),(s==null?void 0:s.role)==="CUSTOMER"||s===void 0?e.jsx(O,{}):e.jsx(R,{}),e.jsxs("div",{className:"flex-1 h-dvh overflow-hidden",children:[e.jsx("div",{className:`
                    fixed left-0 w-full z-20 bg-white transition-all duration-300 pb-5 shadow-sm items-center  ease-in-out
                    ${i?"top-[46px]":"top-0"}
                  `,children:e.jsx(re,{})}),e.jsx("div",{className:`fixed  w-full pb-10 left-0 ${i?"h-[calc(100dvh-120px)]":"h-[calc(100dvh-80px)]"} transition-all  ease-in-out duration-300 overflow-y-auto ${i?"top-[120px]":"top-[80px]"} `,ref:l,children:e.jsx(ae,{})})]})]})}export{je as default};

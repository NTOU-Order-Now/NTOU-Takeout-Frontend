import{j as e,F as S,e as k,P as f,d as B,a as C,g as D,h as K,i as P,r as p,k as E,l as L,m as T,L as F,A as M,n as R}from"./index-CUvlouwC.js";import{u as q}from"./useSystemContext-DClMjCZR.js";import{u as z}from"./sidebarStore-D4LQpN2o.js";import{S as O}from"./Sidebar-H3-zTJLY.js";import{u as A,a as V}from"./index-BGB-1xRi.js";import{u as _}from"./merchantStore-CIAG8v1l.js";import{b as H}from"./blur-CmPELEyu.js";import"./themeStore-DJowlbEU.js";const Q=()=>{const{cartCount:t,refetchCart:s,userInfo:a}=q();return a&&t===void 0&&s(),console.debug("CartIcon cartCount:",t),e.jsxs("div",{className:"relative inline-flex items-center right-2 top-1",children:[e.jsx(S,{icon:k,className:"text-xl"}),t>0&&e.jsx("span",{className:"absolute -top-2 -right-2 flex items-center justify-center min-w-[18px] h-[18px] text-xs bg-red-500 text-white rounded-full px-1",children:t})]})},v=({title:t,onLeftClick:s=()=>{}})=>{const a=B(),c=C.get("authToken"),i=D(d=>d.user),l=()=>{c&&i!==void 0&&i.role==="CUSTOMER"?a("/cart"):a("/auth/login")};return e.jsxs("header",{className:"fixed z-30  top-0 left-0 w-full flex justify-between items-center bg-white shadow-md transition-shadow duration-300 ease-in-out p-2 font-notoTC",children:[e.jsx("div",{className:"text-xl cursor-pointer",onClick:s,children:e.jsx(S,{icon:K})}),e.jsx("h1",{className:"font-noto font-bold text-2xl m-0",children:e.jsx("a",{href:"/Order-Now-Frontend/",children:t})}),e.jsx("div",{className:"text-xl cursor-pointer",onClick:l,children:e.jsx(Q,{})})]})};v.propTypes={title:f.string,leftIcon:f.object,rightIcon:f.object,onLeftClick:f.func,onRightClick:f.func};const n=P(t=>({selectedSortBy:localStorage.getItem("selectedSortBy"),selectedSortDir:localStorage.getItem("selectedSortDir"),selectedKeyword:localStorage.getItem("selectedKeyword"),isSubmitted:!0,showSelectionBar:!1,setSelectedKeyword:s=>t({selectedKeyword:s}),setSelectedSortBy:s=>t({selectedSortBy:s}),setSelectedSortDir:s=>t({selectedSortDir:s}),setIsSubmitted:s=>t({isSubmitted:s}),setShowSelectionBar:s=>t({showSelectionBar:s})})),U=()=>{const t=n(o=>o.setShowSelectionBar),s=n(o=>o.selectedSortBy),a=n(o=>o.selectedSortDir),c=n(o=>o.selectedKeyword),i=n(o=>o.setSelectedSortBy),l=n(o=>o.setSelectedSortDir),d=n(o=>o.setSelectedKeyword),x=n(o=>o.setIsSubmitted);p.useEffect(()=>{localStorage.setItem("selectedSortBy",s),localStorage.setItem("selectedSortDir",a),localStorage.setItem("selectedKeyword",c)},[s,a,c]);const g=()=>{const o=document.getElementById("inputKeyword").value;d(o),x(!0),t(!1)},u=o=>{i(s===o?"":o)},m=o=>{l(a===o?"":o)};return e.jsx("div",{className:"font-notoTC w-[361px] max-w-[800px] rounded-xl bg-white border-gray-700 mt-2 p-4 animate-slide-down",children:e.jsxs("div",{className:"flex justify-around w-full",children:[e.jsxs("div",{className:"flex flex-col w-[40%]",children:[e.jsx("p",{className:"text-xl",children:"篩選"}),e.jsxs("label",{className:"mt-2 flex justify-between items-center cursor-pointer",children:["評價 (預設)",e.jsx("input",{type:"radio",checked:s==="rating",onChange:()=>u("rating"),onClick:()=>u("rating"),className:"appearance-none w-4 h-4 border-2 border-black rounded-full checked:bg-blue-500 checked:border-blue-500",name:"sortBy"})]}),e.jsxs("label",{className:"mt-2 flex justify-between items-center cursor-pointer",children:["平均花費",e.jsx("input",{type:"radio",checked:s==="averageSpend",onChange:()=>u("averageSpend"),onClick:()=>u("averageSpend"),className:"appearance-none w-4 h-4 border-2 border-black rounded-full checked:bg-blue-500 checked:border-blue-500",name:"sortBy"})]})]}),e.jsxs("div",{className:"flex flex-col w-[40%]",children:[e.jsx("p",{className:"text-xl",children:"排序"}),e.jsxs("label",{className:"mt-2 flex justify-between items-center cursor-pointer",children:["由高到低 (預設)",e.jsx("input",{type:"radio",checked:a==="desc",onChange:()=>m("desc"),onClick:()=>m("desc"),className:"appearance-none w-4 h-4 border-2 border-black rounded-full checked:bg-blue-500 checked:border-blue-500",name:"sortDir"})]}),e.jsxs("label",{className:"mt-2 flex justify-between items-center cursor-pointer",children:["由低到高",e.jsx("input",{type:"radio",checked:a==="asc",onChange:()=>m("asc"),onClick:()=>m("asc"),className:"appearance-none w-4 h-4 border-2 border-black rounded-full checked:bg-blue-500 checked:border-blue-500",name:"sortDir"})]}),e.jsx("div",{className:"mt-2 flex justify-end items-center cursor-pointer",onClick:g,children:e.jsx("div",{className:"border-2 rounded-xl border-black w-[50%] flex justify-around items-center py-1",children:e.jsx("span",{children:"確認"})})})]})]})})},G=()=>{const t=n(r=>r.showSelectionBar),s=n(r=>r.setShowSelectionBar),a=n(r=>r.selectedSortBy),c=n(r=>r.selectedSortDir),i=n(r=>r.selectedKeyword),l=n(r=>r.setSelectedSortBy),d=n(r=>r.setSelectedSortDir),x=n(r=>r.setSelectedKeyword),g=n(r=>r.setIsSubmitted);p.useEffect(()=>{const r=localStorage.getItem("selectedSortBy"),w=localStorage.getItem("selectedSortDir"),y=localStorage.getItem("selectedKeyword");r=="null"&&localStorage.setItem("selectedSortBy","rating"),w=="null"&&localStorage.setItem("selectedSortDir","desc"),y=="null"&&localStorage.setItem("selectedKeyword",""),l(r||"rating"),d(w||"desc"),x(y||"")},[x,l,d]),p.useEffect(()=>{localStorage.setItem("selectedSortBy",a),localStorage.setItem("selectedSortDir",c),localStorage.setItem("selectedKeyword",i)},[a,c,i]);const[u,m]=p.useState(localStorage.getItem("selectedKeyword")),o=()=>{s(!t)},b=()=>{const r=document.getElementById("inputKeyword").value;m(r),x(r),g(!0),s(!1)},h=r=>{r.key==="Enter"&&(b(),r.preventDefault())};return e.jsxs("div",{className:"font-notoTC flex flex-row items-center w-full  mt-5 px-5 box-border",children:[e.jsxs("div",{className:"relative text-2xl flex items-center justify-center cursor-pointer",onClick:o,children:[e.jsx(S,{icon:E}),!(a===""&&c==="")&&e.jsx("div",{className:"absolute -top-[17px] right-[-4px] z-45",children:e.jsx(S,{icon:L,className:"w-3",style:{color:"#ff0a0a"}})})]}),e.jsx("input",{type:"text",className:"w-full mx-2 border-2 rounded-xl  border-zinc-500 outline-none text-lg py-1",placeholder:" 想吃什麼...",id:"inputKeyword",onKeyDown:h,value:u,onChange:r=>m(r.target.value)}),e.jsx("div",{className:"text-2xl flex items-center justify-center cursor-pointer",onClick:b,children:e.jsx(S,{icon:T})}),t&&e.jsx(U,{})]})};var N={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var s="fas",a="star",c=576,i=512,l=[11088,61446],d="f005",x="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z";t.definition={prefix:s,iconName:a,icon:[c,i,l,d,x]},t.faStar=t.definition,t.prefix=s,t.iconName=a,t.width=c,t.height=i,t.ligatures=l,t.unicode=d,t.svgPathData=x,t.aliases=l})(N);const I=t=>{const{id:s,name:a,averageSpend:c,rating:i,picture:l}=t;return e.jsx(F,{to:`/menu/${s}`,children:e.jsxs("div",{className:"font-notoTC relative  h-60 bg-white rounded-2xl overflow-hidden shadow-lg transition-transform hover:scale-105",children:[e.jsx("div",{className:"object-cover w-full h-full",children:e.jsx(H.LazyLoadImage,{src:l,alt:a,effect:"blur",className:"relative w-full h-[65%] object-cover",wrapperClassName:"object-cover w-full h-full"})}),e.jsxs("div",{className:"absolute  h-[87px] w-full top-[154px] border-gray-300 mt-1 ",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"absolute h-[22px] left-[12px] top-[9px] text-black font-bold text-lg leading-5 line-clamp-3 overflow-hidden break-words transition",children:a}),e.jsxs("div",{className:"absolute h-[12px] left-[12px] top-[32px] text-gray-500 font-semibold text-xs leading-[12px]",children:["距離您約 ",10," 公里"]})]}),e.jsxs("div",{className:"flex flex-row w-full relative justify-between -bottom-14 items-center mx-4 ",children:[e.jsxs("div",{className:" text-green-700 font-bold text-xs leading-[12px]",children:["平均花費約 ",Math.floor(c)," 元"]}),e.jsxs("div",{className:"flex flex-row mr-7",children:[e.jsx(S,{icon:N.faStar,style:{color:"#FFD43B"},className:"h-[0.80em] top-0.5 relative pr-1"}),e.jsx("span",{className:"font-medium text-[13px] leading-[15px] text-gray-600 mb-[-1px]",children:i.toFixed(1)})]})]})]})]})},s)};I.propTypes={id:f.string.isRequired,name:f.string.isRequired,averageSpend:f.number.isRequired,rating:f.number.isRequired,picture:f.string.isRequired};const j=()=>e.jsxs("div",{className:`relative w-[90vw] h-[241px] m-2 bg-white/30 backdrop-blur-sm border-2 
                    border-gray-300 rounded-2xl overflow-hidden animate-pulse`,children:[e.jsx("div",{className:"w-full h-[65%] bg-gray-200/50"}),e.jsxs("div",{className:"box-border absolute w-[90vw] h-[87px] left-0 top-[154px] border-t-2 border-gray-300",children:[e.jsx("div",{className:"absolute h-[22px] left-[12px] top-[9px]",children:e.jsx("div",{className:"h-5 bg-gray-200/50 rounded w-40"})}),e.jsx("div",{className:"absolute h-[12px] left-[12px] top-[32px]",children:e.jsx("div",{className:"h-3 bg-gray-200/50 rounded w-32"})}),e.jsx("div",{className:"absolute h-[12px] left-[12px] top-[57px]",children:e.jsx("div",{className:"h-3 bg-gray-200/50 rounded w-36"})}),e.jsx("div",{className:"absolute w-[75px] h-[20px] right-[3px] bottom-[11px] flex items-center",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-200/50 rounded-full"}),e.jsx("div",{className:"h-4 bg-gray-200/50 rounded w-16"})]})})]})]}),Z=async(t,s,a,c,i)=>{try{return(await M.get("/v3/stores/search",{params:{keyword:t,sortBy:s,sortDir:a,page:c,size:i}})).data}catch(l){throw console.error("Get store data error:",l),l}},$=(t,s,a,c)=>{const{data:i,fetchNextPage:l,hasNextPage:d,isFetchingNextPage:x,isLoading:g,isError:u,error:m}=A({queryKey:["storeData",t,s,a],queryFn:async({pageParam:o})=>(await Z(t,s,a,o,c)).data,initialPageParam:0,getNextPageParam:o=>o.currentPage<o.totalPages?o.currentPage+1:void 0,staleTime:6e4});return{storeData:i,fetchNextPage:l,hasNextPage:d,isFetchingNextPage:x,isLoading:g,isError:u,error:m}};function J(){_();const t=5;n(h=>h.isSubmitted),n(h=>h.setIsSubmitted);const{ref:s,inView:a}=V({rootMargin:"500px"});localStorage.getItem("selectedSortBy")==="null"&&localStorage.setItem("selectedSortBy","rating"),localStorage.getItem("selectedSortDir")==="null"&&localStorage.setItem("selectedSortDir","desc"),localStorage.getItem("selectedKeyword")==="null"&&localStorage.setItem("selectedKeyword","");const c=localStorage.getItem("selectedSortBy"),i=localStorage.getItem("selectedSortDir"),l=localStorage.getItem("selectedKeyword"),{storeData:d,fetchNextPage:x,hasNextPage:g,isFetchingNextPage:u,isLoading:m,isError:o,error:b}=$(l,c,i,t);return p.useEffect(()=>{a&&!u&&g&&(console.debug("fetchNextPage"),x())},[a,u,g,x]),o?e.jsx("div",{className:"text-center",children:b}):m?e.jsx("div",{className:"flex justify-center items-center mt-4 fa-2x",children:e.jsx(S,{icon:R,spinPulse:!0})}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 lg:p-20 p-8",children:[d==null?void 0:d.pages.map(h=>h.content.map(r=>e.jsx(p.Suspense,{fallback:e.jsx(j,{}),children:e.jsx(I,{id:r.id,name:r.name,averageSpend:r.averageSpend,rating:r.rating,reviews:r.reviewIdList,picture:r.picture,className:"w-full h-full bg-white border border-gray-300 rounded-xl shadow-lg"})},r.id))),e.jsx("div",{ref:s,children:g&&u&&e.jsx("div",{className:"flex justify-center items-center mt-4 fa-2x",children:e.jsx(j,{})})})]})}function ae(){const t=z(s=>s.toggleSidebar);return e.jsxs("div",{className:"flex flex-col h-screen w-full",children:[e.jsx(v,{title:"OrderNow",onLeftClick:t,className:"fixed top-0"}),e.jsx("div",{className:"py-5"}),e.jsx(O,{}),e.jsx(G,{}),e.jsx(J,{})]})}export{ae as default};

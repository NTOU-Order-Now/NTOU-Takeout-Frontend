import{j as e,F as p,e as q,P as h,d as F,a as R,g as z,h as O,i as V,r as w,k as _,l as A,m as H,L as Q,n as U,o as Z,p as D}from"./index-Bimiw5Kl.js";import{u as $}from"./useSystemContext-BllPy76F.js";import{u as G}from"./sidebarStore-CpM3onKa.js";import{S as J}from"./Sidebar-I9TU2xn-.js";import{u as W,a as X}from"./index-CzriHDY2.js";import{u as Y}from"./merchantStore-BEUAFrLc.js";import{b as ee}from"./blur-CDRptKMI.js";import"./themeStore-CSb6XuXV.js";const te=()=>{const{cartCount:t,refetchCart:s,userInfo:l}=$();return l&&t===void 0&&s(),console.debug("CartIcon cartCount:",t),e.jsxs("div",{className:"relative inline-flex items-center right-2 top-1",children:[e.jsx(p,{icon:q,className:"text-xl"}),t>0&&e.jsx("span",{className:"absolute -top-2 -right-2 flex items-center justify-center min-w-[18px] h-[18px] text-xs bg-red-500 text-white rounded-full px-1",children:t})]})},L=({title:t,onLeftClick:s=()=>{}})=>{const l=F(),i=R.get("authToken"),d=z(n=>n.user),c=()=>{i&&d!==void 0&&d.role==="CUSTOMER"?l("/cart"):l("/auth/login")};return e.jsxs("header",{className:"fixed z-30  top-0 left-0 w-full flex justify-between items-center bg-white shadow-md transition-shadow duration-300 ease-in-out p-2 font-notoTC",children:[e.jsx("div",{className:"text-xl cursor-pointer",onClick:s,children:e.jsx(p,{icon:O})}),e.jsx("h1",{className:"font-noto font-bold text-2xl m-0",children:e.jsx("a",{href:"/Order-Now-Frontend/",children:t})}),e.jsx("div",{className:"text-xl cursor-pointer",onClick:c,children:e.jsx(te,{})})]})};L.propTypes={title:h.string,leftIcon:h.object,rightIcon:h.object,onLeftClick:h.func,onRightClick:h.func};const o=V(t=>({selectedSortBy:localStorage.getItem("selectedSortBy"),selectedSortDir:localStorage.getItem("selectedSortDir"),selectedKeyword:localStorage.getItem("selectedKeyword"),isSubmitted:!0,showSelectionBar:!1,setSelectedKeyword:s=>t({selectedKeyword:s}),setSelectedSortBy:s=>t({selectedSortBy:s}),setSelectedSortDir:s=>t({selectedSortDir:s}),setIsSubmitted:s=>t({isSubmitted:s}),setShowSelectionBar:s=>t({showSelectionBar:s})})),se=()=>{const t=o(a=>a.setShowSelectionBar),s=o(a=>a.selectedSortBy),l=o(a=>a.selectedSortDir),i=o(a=>a.selectedKeyword),d=o(a=>a.setSelectedSortBy),c=o(a=>a.setSelectedSortDir),n=o(a=>a.setSelectedKeyword),u=o(a=>a.setIsSubmitted);w.useEffect(()=>{localStorage.setItem("selectedSortBy",s),localStorage.setItem("selectedSortDir",l),localStorage.setItem("selectedKeyword",i)},[s,l,i]);const b=()=>{const a=document.getElementById("inputKeyword").value;n(a),u(!0),t(!1)},x=a=>{d(s===a?"":a)},g=a=>{c(l===a?"":a)};return e.jsx("div",{className:"font-notoTC w-[361px] max-w-[800px] rounded-xl bg-white border-gray-700 mt-2 p-4 animate-slide-down",children:e.jsxs("div",{className:"flex justify-around w-full",children:[e.jsxs("div",{className:"flex flex-col w-[40%]",children:[e.jsx("p",{className:"text-xl",children:"篩選"}),e.jsxs("label",{className:"mt-2 flex justify-between items-center cursor-pointer",children:["評價 (預設)",e.jsx("input",{type:"radio",checked:s==="rating",onChange:()=>x("rating"),onClick:()=>x("rating"),className:"appearance-none w-4 h-4 border-2 border-black rounded-full checked:bg-blue-500 checked:border-blue-500",name:"sortBy"})]}),e.jsxs("label",{className:"mt-2 flex justify-between items-center cursor-pointer",children:["平均花費",e.jsx("input",{type:"radio",checked:s==="averageSpend",onChange:()=>x("averageSpend"),onClick:()=>x("averageSpend"),className:"appearance-none w-4 h-4 border-2 border-black rounded-full checked:bg-blue-500 checked:border-blue-500",name:"sortBy"})]})]}),e.jsxs("div",{className:"flex flex-col w-[40%]",children:[e.jsx("p",{className:"text-xl",children:"排序"}),e.jsxs("label",{className:"mt-2 flex justify-between items-center cursor-pointer",children:["由高到低 (預設)",e.jsx("input",{type:"radio",checked:l==="desc",onChange:()=>g("desc"),onClick:()=>g("desc"),className:"appearance-none w-4 h-4 border-2 border-black rounded-full checked:bg-blue-500 checked:border-blue-500",name:"sortDir"})]}),e.jsxs("label",{className:"mt-2 flex justify-between items-center cursor-pointer",children:["由低到高",e.jsx("input",{type:"radio",checked:l==="asc",onChange:()=>g("asc"),onClick:()=>g("asc"),className:"appearance-none w-4 h-4 border-2 border-black rounded-full checked:bg-blue-500 checked:border-blue-500",name:"sortDir"})]}),e.jsx("div",{className:"mt-2 flex justify-end items-center cursor-pointer",onClick:b,children:e.jsx("div",{className:"border-2 rounded-xl border-black w-[50%] flex justify-around items-center py-1",children:e.jsx("span",{children:"確認"})})})]})]})})},re=()=>{const t=o(r=>r.showSelectionBar),s=o(r=>r.setShowSelectionBar),l=o(r=>r.selectedSortBy),i=o(r=>r.selectedSortDir),d=o(r=>r.selectedKeyword),c=o(r=>r.setSelectedSortBy),n=o(r=>r.setSelectedSortDir),u=o(r=>r.setSelectedKeyword),b=o(r=>r.setIsSubmitted);w.useEffect(()=>{const r=localStorage.getItem("selectedSortBy"),y=localStorage.getItem("selectedSortDir"),S=localStorage.getItem("selectedKeyword");r=="null"&&localStorage.setItem("selectedSortBy","rating"),y=="null"&&localStorage.setItem("selectedSortDir","desc"),S=="null"&&localStorage.setItem("selectedKeyword",""),c(r||"rating"),n(y||"desc"),u(S||"")},[u,c,n]),w.useEffect(()=>{localStorage.setItem("selectedSortBy",l),localStorage.setItem("selectedSortDir",i),localStorage.setItem("selectedKeyword",d)},[l,i,d]);const[x,g]=w.useState(localStorage.getItem("selectedKeyword")),a=()=>{s(!t)},j=()=>{const r=document.getElementById("inputKeyword").value;g(r),u(r),b(!0),s(!1)},I=r=>{r.key==="Enter"&&(j(),r.preventDefault())};return e.jsxs("div",{className:"font-notoTC flex flex-row items-center w-full  mt-5 px-5 box-border",children:[e.jsxs("div",{className:"relative text-2xl flex items-center justify-center cursor-pointer",onClick:a,children:[e.jsx(p,{icon:_}),!(l===""&&i==="")&&e.jsx("div",{className:"absolute -top-[17px] right-[-4px] z-45",children:e.jsx(p,{icon:A,className:"w-3",style:{color:"#ff0a0a"}})})]}),e.jsx("input",{type:"text",className:"w-full mx-2 border-2 rounded-xl  border-zinc-500 outline-none text-lg py-1",placeholder:" 想吃什麼...",id:"inputKeyword",onKeyDown:I,value:x,onChange:r=>g(r.target.value)}),e.jsx("div",{className:"text-2xl flex items-center justify-center cursor-pointer",onClick:j,children:e.jsx(p,{icon:H})}),t&&e.jsx(se,{})]})};var E={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var s="fas",l="star",i=576,d=512,c=[11088,61446],n="f005",u="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z";t.definition={prefix:s,iconName:l,icon:[i,d,c,n,u]},t.faStar=t.definition,t.prefix=s,t.iconName=l,t.width=i,t.height=d,t.ligatures=c,t.unicode=n,t.svgPathData=u,t.aliases=c})(E);const M=t=>{const{id:s,name:l,averageSpend:i,rating:d,picture:c,reviews:n}=t;return e.jsx(Q,{to:`/menu/${s}`,children:e.jsxs("div",{className:"font-notoTC relative  h-60 bg-white rounded-2xl overflow-hidden shadow-lg transition-transform hover:scale-105",children:[e.jsx("div",{className:"object-cover w-full h-full",children:e.jsx(ee.LazyLoadImage,{src:c,alt:l,effect:"blur",className:"relative w-full h-[65%] object-cover",wrapperClassName:"object-cover w-full h-full"})}),e.jsxs("div",{className:"absolute  h-[87px] w-full top-[154px] border-gray-300 mt-1 ",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"absolute h-[22px] left-[12px] top-[9px] text-black font-bold text-lg leading-5 line-clamp-3 overflow-hidden break-words transition",children:l}),e.jsxs("div",{className:"absolute h-[12px] left-[12px] top-[32px] text-gray-500 font-semibold text-xs leading-[12px]",children:["距離您約 ",10," 公里"]})]}),e.jsxs("div",{className:"flex flex-row w-full relative justify-between -bottom-14 items-center mx-4 ",children:[e.jsxs("div",{className:" text-green-700 font-bold text-xs leading-[12px]",children:["平均花費約 ",Math.floor(i)," 元"]}),e.jsxs("div",{className:"flex flex-row mr-7",children:[e.jsx(p,{icon:E.faStar,style:{color:"#FFD43B"},className:"h-[0.80em] w-[0.80em] "}),e.jsxs("span",{className:"font-medium text-[13px] leading-[15px] text-gray-600 mb-[-1px]",children:[d.toFixed(1)," (",n.length,")"]})]})]})]})]})},s)};M.propTypes={id:h.string.isRequired,name:h.string.isRequired,averageSpend:h.number.isRequired,rating:h.number.isRequired,picture:h.string.isRequired,reviews:h.array.isRequired};const K=()=>e.jsxs("div",{className:`relative w-[90vw] h-[241px] m-2 bg-white/30 backdrop-blur-sm border-2 
                    border-gray-300 rounded-2xl overflow-hidden animate-pulse`,children:[e.jsx("div",{className:"w-full h-[65%] bg-gray-200/50"}),e.jsxs("div",{className:"box-border absolute w-[90vw] h-[87px] left-0 top-[154px] border-t-2 border-gray-300",children:[e.jsx("div",{className:"absolute h-[22px] left-[12px] top-[9px]",children:e.jsx("div",{className:"h-5 bg-gray-200/50 rounded w-40"})}),e.jsx("div",{className:"absolute h-[12px] left-[12px] top-[32px]",children:e.jsx("div",{className:"h-3 bg-gray-200/50 rounded w-32"})}),e.jsx("div",{className:"absolute h-[12px] left-[12px] top-[57px]",children:e.jsx("div",{className:"h-3 bg-gray-200/50 rounded w-36"})}),e.jsx("div",{className:"absolute w-[75px] h-[20px] right-[3px] bottom-[11px] flex items-center",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-200/50 rounded-full"}),e.jsx("div",{className:"h-4 bg-gray-200/50 rounded w-16"})]})})]})]});function ae(){const{addMerchants:t}=Y(),s=4,l=o(f=>f.isSubmitted),i=o(f=>f.setIsSubmitted),{ref:d,inView:c}=W({rootMargin:"500px"});localStorage.getItem("selectedSortBy")==="null"&&localStorage.setItem("selectedSortBy","rating"),localStorage.getItem("selectedSortDir")==="null"&&localStorage.setItem("selectedSortDir","desc"),localStorage.getItem("selectedKeyword")==="null"&&localStorage.setItem("selectedKeyword","");const n=localStorage.getItem("selectedSortBy"),u=localStorage.getItem("selectedSortDir"),b=localStorage.getItem("selectedKeyword"),{data:x,isLoading:g,isError:a,error:j,isSuccess:I}=U({queryKey:["MerchantIdList",n,u,b],queryFn:async()=>{const f=await D.getStoreIdList({sortBy:n,sortDir:u,keyword:b});return i(!1),f.data},enabled:l&&!!n&&!!u,staleTime:1e3*60*10}),{data:r,fetchNextPage:y,hasNextPage:S,isFetchingNextPage:k,isLoading:P,isError:B,error:T}=X({queryKey:["merchants",x],queryFn:async({pageParam:f})=>{const m=f*s,v=m+s,N=x.slice(m,v);if(N.length===0)return[];const C=await D.getMerchantsByIdList(N);return t(C.data),C.data},initialPageParam:0,getNextPageParam:(f,m)=>{const v=m.length,N=(x==null?void 0:x.length)||0;if(v*s<N)return v},enabled:I});return w.useEffect(()=>{c&&!k&&S&&y()},[c,k,S,y]),a||B?e.jsxs("div",{className:"text-center",children:[a&&j.message,B&&T.message]}):g||P?e.jsx("div",{className:"flex justify-center items-center mt-4 fa-2x",children:e.jsx(p,{icon:Z,spinPulse:!0})}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 lg:p-20 p-8",children:[r==null?void 0:r.pages.map(f=>f.map(m=>e.jsx(w.Suspense,{fallback:e.jsx(K,{}),children:e.jsx(M,{id:m.id,name:m.name,averageSpend:m.averageSpend,rating:m.rating,reviews:m.reviewIdList,picture:m.picture,className:"w-full h-full bg-white border border-gray-300 rounded-xl shadow-lg"})},m.id))),e.jsx("div",{ref:d,children:S&&e.jsx("div",{className:"flex justify-center items-center mt-4 fa-2x",children:e.jsx(K,{})})})]})}function me(){const t=G(s=>s.toggleSidebar);return e.jsxs("div",{className:"flex flex-col h-screen w-full",children:[e.jsx(L,{title:"OrderNow",onLeftClick:t,className:"fixed top-0"}),e.jsx("div",{className:"py-5"}),e.jsx(J,{}),e.jsx(re,{}),e.jsx(ae,{})]})}export{me as default};

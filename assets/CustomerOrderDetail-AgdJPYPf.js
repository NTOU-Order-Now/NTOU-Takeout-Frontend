import{A as b,b as y,f as j,c as D,j as t,i as v,H as E}from"./index-Cw-wFHxr.js";import{u as w}from"./orderStore-BS8eYOzD.js";import{U as N,O as I,E as S}from"./EstimatedTime-Qfu7_hpj.js";import{H as L}from"./Header-CwwPu8U4.js";import{F as P,p as k}from"./index-DBIAE8Aj.js";import{u as A}from"./useSystemContext-DFNIlIRi.js";import{u as O}from"./useCategoryQueries-EhajT4ub.js";import{C as T}from"./CartItemCard-CRY6Figu.js";import"./useQueries-C52At0ip.js";import"./useMutation-1xaQ7THY.js";import"./blur-C7LWzxEu.js";const q=async(e,o)=>{try{return(await b.post("/v1/stores/query",e,{signal:o})).data}catch(s){if(y.isCancel(s)){console.debug("Get store data request cancelled");return}else console.error("Get store data error:",s);throw s}},G=e=>{const{data:o,isLoading:s,isError:a,refetch:l}=j({queryKey:["store",e],queryFn:({signal:i})=>q(e,i),enabled:e.length>0,staleTime:9e5});return{storeData:o,isLoading:s,isError:a,refetch:l}},H=()=>{const e=w(r=>r.orderData),o={PENDING:{text:"未接單",bgColor:"bg-stone-600"},PROCESSING:{text:"製作中",bgColor:"bg-blue-500"},COMPLETED:{text:"未取餐",bgColor:"bg-yellow-500"},PICKED_UP:{text:"已取餐",bgColor:"bg-green-500"},CANCELED:{text:"取消",bgColor:"bg-gray-300"}},s=D(),a=r=>o[r]||{text:"default",bgColor:"bg-gray-200"},l=t.jsx("button",{className:`${a(e==null?void 0:e.status).bgColor} text-sm px-3 py-1 rounded-md text-white font-bold`,children:a(e==null?void 0:e.status).text}),{userInfo:i}=A();if(e===null){s("/history/order");return}const{storeData:n,isLoaing:f,isError:x}=G([e.storeId]),c=n?n[0].menuId:null,{menuCategoryList:g}=v(c),{categoryData:p}=O(g,c,i!==void 0&&c!==void 0),h=()=>{s(-1)},C=r=>{const m=p.flatMap(u=>u.dishes).find(u=>u.id===r);return m?m.picture:null};return f||n===void 0||x?t.jsx(E,{}):t.jsxs("div",{className:"flex flex-col h-screen",children:[t.jsx("div",{className:"sticky mt-[54px] z-50 shadow-sm",children:t.jsx(L,{LeftIcon:t.jsx(P,{icon:k}),title:"單號 "+e.id.slice(-5),onLeftClick:h,rightComponents:[l]})}),t.jsxs("div",{className:"flex-1 overflow-auto pb-[48px]",children:[t.jsxs("div",{className:"bg-white text-black flex-1 p-4 overflow-auto",children:[t.jsx(N,{user:e,storeData:n[0],role:i.role}),t.jsx(I,{note:e.note}),e.orderedDishes.map((r,d)=>t.jsx(T,{dishData:r,imageUrl:C(r.dishId),showAdjustBtn:!1},d))]}),t.jsx("div",{className:"fixed bottom-0 left-0 right-0 w-full",children:t.jsx(S,{value:e.estimatedPrepTime})})]})]})};H.propTypes={};export{H as default};

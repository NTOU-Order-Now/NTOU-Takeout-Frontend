import{j as e,P as g,c as z,a as C,d as B,e as A,r as w,L as H,f as Q,g as E}from"./index-DYHXqZsK.js";import{F as b,a as _,b as q,c as $,d as Z,e as G,g as J,h as W,i as X,j as Y,k as ee}from"./index-CmwBhuE2.js";import{u as te}from"./useSystemContext-CjQp9xYW.js";import{u as D}from"./sidebarStore-CBGqq18Z.js";import{u as T,S as j}from"./themeStore-j_gPQzti.js";import{u as se,a as re}from"./index-CCBoGqfl.js";import{u as oe}from"./merchantStore-DIEql55-.js";import{b as ae}from"./blur-DrY2LElb.js";const le=()=>{const{cartCount:t,refetchCart:s}=te();return t===void 0&&s(),console.debug("CartIcon cartCount:",t),e.jsxs("div",{className:"relative inline-flex items-center right-2 top-1",children:[e.jsx(b,{icon:_,className:"text-xl"}),t>0&&e.jsx("span",{className:"absolute -top-2 -right-2 flex items-center justify-center min-w-[18px] h-[18px] text-xs bg-red-500 text-white rounded-full px-1",children:t})]})},F=({title:t,onLeftClick:s=()=>{}})=>{const a=z(),n=C.get("authToken"),x=B(l=>l.user),i=()=>{n&&x!==void 0&&x.role==="CUSTOMER"?a("/cart"):a("/auth/login")};return e.jsxs("header",{className:"fixed z-30  top-0 left-0 w-full flex justify-between items-center bg-white shadow-md transition-shadow duration-300 ease-in-out p-2 font-notoTC",children:[e.jsx("div",{className:"text-xl cursor-pointer",onClick:s,children:e.jsx(b,{icon:q})}),e.jsx("h1",{className:"font-noto font-bold text-2xl m-0",children:e.jsx("a",{href:"/Order-Now-Frontend/",children:t})}),e.jsx("div",{className:"text-xl cursor-pointer",onClick:i,children:e.jsx(le,{})})]})};F.propTypes={title:g.string,leftIcon:g.object,rightIcon:g.object,onLeftClick:g.func,onRightClick:g.func};const ce=()=>{const t=D(d=>d.isOpen);T(d=>d.themeMode),T(d=>d.toggleTheme);const s=D(d=>d.closeSidebar),a=z(),n=C.get("authToken"),x=B(d=>d.user),i=B(d=>d.setUser);let l="登入";n&&x!==void 0?l=x.name:l="登入";const u=()=>{C.remove("authToken"),i(void 0),a("/auth/login"),s()};return e.jsxs(e.Fragment,{children:[t&&e.jsx("div",{className:`fixed top-0 z-40 min-h-screen min-w-full transition-all duration-300  ${t?"bg-slate-950 bg-opacity-20":""}`,onClick:s}),e.jsxs("div",{className:`font-notoTC z-50 fixed inset-y-0 left-0 bg-white w-3/5 shadow-lg border-zinc-400 border-r-1 max-w-md ${t?"translate-x-0":"-translate-x-full"} transition-transform duration-300 min-w-48`,children:[e.jsxs("div",{className:"p-4 overflow-hidden",children:[e.jsx(j,{text:l,textStyle:"text-2xl px-2 ",icon:q,iconSize:"2xl",iconColor:"#053766",style:"py-8",path:"/auth/login"}),e.jsx(j,{text:"歷史訂單",icon:$,iconSize:"lg",iconColor:"#053766",style:"px-4 py-4",path:"/history/order"}),e.jsx(j,{text:"購物車",icon:Z,iconSize:"lg",iconColor:"#053766",style:"px-4 py-4",path:"/cart"}),e.jsx(j,{text:"問題回報",icon:G,iconSize:"lg",iconColor:"#053766",style:"px-4 py-4"})]}),e.jsx("div",{className:"px-4 absolute bottom-8 left-0 right-2 flex justify-between",children:n&&e.jsx(j,{text:"登出",icon:J,iconSize:"lg",iconColor:"#606162",onClick:u})})]})]})},c=A(t=>({selectedSortBy:localStorage.getItem("selectedSortBy"),selectedSortDir:localStorage.getItem("selectedSortDir"),selectedKeyword:localStorage.getItem("selectedKeyword"),isSubmitted:!0,showSelectionBar:!1,setSelectedKeyword:s=>t({selectedKeyword:s}),setSelectedSortBy:s=>t({selectedSortBy:s}),setSelectedSortDir:s=>t({selectedSortDir:s}),setIsSubmitted:s=>t({isSubmitted:s}),setShowSelectionBar:s=>t({showSelectionBar:s})})),ne=()=>{const t=c(o=>o.setShowSelectionBar),s=c(o=>o.selectedSortBy),a=c(o=>o.selectedSortDir),n=c(o=>o.selectedKeyword),x=c(o=>o.setSelectedSortBy),i=c(o=>o.setSelectedSortDir),l=c(o=>o.setSelectedKeyword),u=c(o=>o.setIsSubmitted);w.useEffect(()=>{localStorage.setItem("selectedSortBy",s),localStorage.setItem("selectedSortDir",a),localStorage.setItem("selectedKeyword",n)},[s,a,n]);const d=()=>{const o=document.getElementById("inputKeyword").value;l(o),u(!0),t(!1)},m=o=>{x(s===o?"":o)},p=o=>{i(a===o?"":o)};return e.jsx("div",{className:"font-notoTC w-[361px] max-w-[800px] rounded-xl bg-white border-gray-700 mt-2 p-4 animate-slide-down",children:e.jsxs("div",{className:"flex justify-around w-full",children:[e.jsxs("div",{className:"flex flex-col w-[40%]",children:[e.jsx("p",{className:"text-xl",children:"篩選"}),e.jsxs("label",{className:"mt-2 flex justify-between items-center cursor-pointer",children:["評價 (預設)",e.jsx("input",{type:"radio",checked:s==="rating",onChange:()=>m("rating"),onClick:()=>m("rating"),className:"appearance-none w-4 h-4 border-2 border-black rounded-full checked:bg-blue-500 checked:border-blue-500",name:"sortBy"})]}),e.jsxs("label",{className:"mt-2 flex justify-between items-center cursor-pointer",children:["平均花費",e.jsx("input",{type:"radio",checked:s==="averageSpend",onChange:()=>m("averageSpend"),onClick:()=>m("averageSpend"),className:"appearance-none w-4 h-4 border-2 border-black rounded-full checked:bg-blue-500 checked:border-blue-500",name:"sortBy"})]})]}),e.jsxs("div",{className:"flex flex-col w-[40%]",children:[e.jsx("p",{className:"text-xl",children:"排序"}),e.jsxs("label",{className:"mt-2 flex justify-between items-center cursor-pointer",children:["由高到低 (預設)",e.jsx("input",{type:"radio",checked:a==="desc",onChange:()=>p("desc"),onClick:()=>p("desc"),className:"appearance-none w-4 h-4 border-2 border-black rounded-full checked:bg-blue-500 checked:border-blue-500",name:"sortDir"})]}),e.jsxs("label",{className:"mt-2 flex justify-between items-center cursor-pointer",children:["由低到高",e.jsx("input",{type:"radio",checked:a==="asc",onChange:()=>p("asc"),onClick:()=>p("asc"),className:"appearance-none w-4 h-4 border-2 border-black rounded-full checked:bg-blue-500 checked:border-blue-500",name:"sortDir"})]}),e.jsx("div",{className:"mt-2 flex justify-end items-center cursor-pointer",onClick:d,children:e.jsx("div",{className:"border-2 rounded-xl border-black w-[50%] flex justify-around items-center py-1",children:e.jsx("span",{children:"確認"})})})]})]})})},ie=()=>{const t=c(r=>r.showSelectionBar),s=c(r=>r.setShowSelectionBar),a=c(r=>r.selectedSortBy),n=c(r=>r.selectedSortDir),x=c(r=>r.selectedKeyword),i=c(r=>r.setSelectedSortBy),l=c(r=>r.setSelectedSortDir),u=c(r=>r.setSelectedKeyword),d=c(r=>r.setIsSubmitted);w.useEffect(()=>{const r=localStorage.getItem("selectedSortBy"),y=localStorage.getItem("selectedSortDir"),S=localStorage.getItem("selectedKeyword");r=="null"&&localStorage.setItem("selectedSortBy","rating"),y=="null"&&localStorage.setItem("selectedSortDir","desc"),S=="null"&&localStorage.setItem("selectedKeyword",""),i(r||"rating"),l(y||"desc"),u(S||"")},[u,i,l]),w.useEffect(()=>{localStorage.setItem("selectedSortBy",a),localStorage.setItem("selectedSortDir",n),localStorage.setItem("selectedKeyword",x)},[a,n,x]);const[m,p]=w.useState(localStorage.getItem("selectedKeyword")),o=()=>{s(!t)},v=()=>{const r=document.getElementById("inputKeyword").value;p(r),u(r),d(!0),s(!1)},k=r=>{r.key==="Enter"&&(v(),r.preventDefault())};return e.jsxs("div",{className:"font-notoTC flex flex-col items-center w-full max-w-[800px] my-5 mx-auto box-border",children:[e.jsxs("div",{className:"flex items-center justify-between w-full px-2",children:[e.jsxs("div",{className:"relative text-2xl flex items-center justify-center cursor-pointer",onClick:o,children:[e.jsx(b,{icon:W}),!(a===""&&n==="")&&e.jsx("div",{className:"absolute -top-[17px] right-[-4px] z-45",children:e.jsx(b,{icon:X,className:"w-3",style:{color:"#ff0a0a"}})})]}),e.jsx("input",{type:"text",className:"flex-grow mx-2 border-b-2 border-black outline-none text-lg py-1",placeholder:"想吃什麼...",id:"inputKeyword",onKeyDown:k,value:m,onChange:r=>p(r.target.value)}),e.jsx("div",{className:"text-2xl flex items-center justify-center cursor-pointer",onClick:v,children:e.jsx(b,{icon:Y})})]}),t&&e.jsx(ne,{})]})};var R={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var s="fas",a="star",n=576,x=512,i=[11088,61446],l="f005",u="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z";t.definition={prefix:s,iconName:a,icon:[n,x,i,l,u]},t.faStar=t.definition,t.prefix=s,t.iconName=a,t.width=n,t.height=x,t.ligatures=i,t.unicode=l,t.svgPathData=u,t.aliases=i})(R);const O=t=>{const{id:s,name:a,averageSpend:n,rating:x,picture:i,reviews:l}=t,u=Math.floor(Math.random()*30)+1;return e.jsx(H,{to:`/menu/${s}`,children:e.jsxs("div",{className:"font-notoTC relative w-full h-60 bg-white rounded-2xl overflow-hidden shadow-lg transition-transform hover:scale-105",children:[e.jsx("div",{className:"object-cover w-full h-full",children:e.jsx(ae.LazyLoadImage,{src:i,alt:"Store Image",className:"relative w-full h-[65%] object-cover",wrapperClassName:"object-cover w-full h-full"})}),e.jsxs("div",{className:"absolute w-[90vw] h-[87px] left-0 top-[154px] border-gray-300 mt-1",children:[e.jsx("div",{className:"absolute h-[22px] left-[12px] top-[9px] text-black font-bold text-lg leading-5",children:a}),e.jsxs("div",{className:"absolute h-[12px] left-[12px] top-[32px] text-gray-500 font-semibold text-xs leading-[12px]",children:["距離您約 ",u," 公里"]}),e.jsxs("div",{className:"absolute h-[12px] left-[12px] top-[57px] text-green-700 font-bold text-xs leading-[12px]",children:["平均花費約 ",n," 元"]}),e.jsx("div",{className:"absolute w-[75px] h-[20px] right-[3px] bottom-[11px] flex items-center",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(b,{icon:R.faStar,style:{color:"#FFD43B"},className:"h-[0.80em] w-[0.80em] mr-[1px]"}),e.jsxs("span",{className:"font-medium text-[13px] leading-[15px] text-gray-600 mb-[-1px]",children:[x," (",l.length,")"]})]})})]})]})},s)};O.propTypes={id:g.string.isRequired,name:g.string.isRequired,averageSpend:g.number.isRequired,rating:g.number.isRequired,picture:g.string.isRequired,reviews:g.array.isRequired};const P=()=>e.jsxs("div",{className:`relative w-[90vw] h-[241px] m-2 bg-white/30 backdrop-blur-sm border-2 
                    border-gray-300 rounded-2xl overflow-hidden animate-pulse`,children:[e.jsx("div",{className:"w-full h-[65%] bg-gray-200/50"}),e.jsxs("div",{className:"box-border absolute w-[90vw] h-[87px] left-0 top-[154px] border-t-2 border-gray-300",children:[e.jsx("div",{className:"absolute h-[22px] left-[12px] top-[9px]",children:e.jsx("div",{className:"h-5 bg-gray-200/50 rounded w-40"})}),e.jsx("div",{className:"absolute h-[12px] left-[12px] top-[32px]",children:e.jsx("div",{className:"h-3 bg-gray-200/50 rounded w-32"})}),e.jsx("div",{className:"absolute h-[12px] left-[12px] top-[57px]",children:e.jsx("div",{className:"h-3 bg-gray-200/50 rounded w-36"})}),e.jsx("div",{className:"absolute w-[75px] h-[20px] right-[3px] bottom-[11px] flex items-center",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-200/50 rounded-full"}),e.jsx("div",{className:"h-4 bg-gray-200/50 rounded w-16"})]})})]})]});function de(){const{addMerchants:t}=oe(),s=4,a=c(f=>f.isSubmitted),n=c(f=>f.setIsSubmitted),{ref:x,inView:i}=se({rootMargin:"100px"});localStorage.getItem("selectedSortBy")==="null"&&localStorage.setItem("selectedSortBy","rating"),localStorage.getItem("selectedSortDir")==="null"&&localStorage.setItem("selectedSortDir","desc"),localStorage.getItem("selectedKeyword")==="null"&&localStorage.setItem("selectedKeyword","");const l=localStorage.getItem("selectedSortBy"),u=localStorage.getItem("selectedSortDir"),d=localStorage.getItem("selectedKeyword"),{data:m,isLoading:p,isError:o,error:v,isSuccess:k}=Q({queryKey:["MerchantIdList",l,u,d],queryFn:async()=>{const f=await E.getStoreIdList({sortBy:l,sortDir:u,keyword:d});return n(!1),f.data},enabled:a,staleTime:1e3*60*10}),{data:r,fetchNextPage:y,hasNextPage:S,isFetchingNextPage:K,isLoading:U,isError:L,error:V}=re({queryKey:["merchants",m],queryFn:async({pageParam:f})=>{const h=f*s,N=h+s,I=m.slice(h,N);if(I.length===0)return[];const M=await E.getMerchantsByIdList(I);return t(M.data),M.data},initialPageParam:0,getNextPageParam:(f,h)=>{const N=h.length,I=(m==null?void 0:m.length)||0;if(N*s<I)return N},enabled:k});return w.useEffect(()=>{i&&!K&&S&&y()},[i,K,S,y]),o||L?e.jsxs("div",{className:"text-center",children:[o&&v.message,L&&V.message]}):p||U?e.jsx("div",{className:"flex justify-center items-center mt-4 fa-2x",children:e.jsx(b,{icon:ee,spinPulse:!0})}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 lg:p-20 p-8",children:[r==null?void 0:r.pages.map(f=>f.map(h=>e.jsx(w.Suspense,{fallback:e.jsx(P,{}),children:e.jsx(O,{id:h.id,name:h.name,averageSpend:h.averageSpend,rating:h.rating,reviews:h.reviewIdList,picture:h.picture,className:"w-full h-full bg-white border border-gray-300 rounded-xl shadow-lg"})},h.id))),e.jsx("div",{ref:x,children:S&&e.jsx("div",{className:"flex justify-center items-center mt-4 fa-2x",children:e.jsx(P,{})})})]})}function be(){const t=D(s=>s.toggleSidebar);return e.jsxs("div",{children:[e.jsx(F,{title:"OrderNow",onLeftClick:t,className:"fixed top-0"}),e.jsx("div",{className:"py-5"}),e.jsx(ce,{}),e.jsx(ie,{}),e.jsx(de,{})]})}export{be as default};

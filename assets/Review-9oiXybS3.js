import{j as e,P as p,r as g,h as P,c as C,g as b}from"./index-Cw-wFHxr.js";import{F as m,h as j,g as y,f as I}from"./index-DBIAE8Aj.js";import{u as R,a as S}from"./index-JR6J-MES.js";import{u as T}from"./merchantStore-DB3DzlM_.js";const E=t=>{const{name:a,starNumber:r,date:c,description:o}=t;return e.jsxs("div",{className:"font-notoTC w-[90%] mx-auto mt-10 p-4 bg-white rounded-lg border border-gray-300",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:a}),e.jsx("span",{className:"text-gray-500 text-sm",children:c})]}),e.jsxs("div",{className:"flex items-center mt-2",children:[[...Array(r)].map((n,i)=>e.jsx(m,{icon:j,className:"text-yellow-300"},i)),[...Array(5-r)].map((n,i)=>e.jsx(m,{icon:j,className:"text-gray-300"},i))]}),e.jsx("p",{className:"mt-2 text-gray-700 leading-relaxed",children:o})]})},L={getReivewByIds:async t=>{console.log("getReviewByIds",t);const a=await fetch("https://ntou-takeout-backend-production.up.railway.app/api/v1/stores/reviews/query",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw new Error(`Failed to fetch details for review ID: ${t}`);return await a.json()}},v=({reviewIdList:t,merchantId:a})=>{const{ref:c,inView:o}=R({rootMargin:"100px"}),{data:n,fetchNextPage:i,hasNextPage:d,isFetchingNextPage:l,isLoading:N}=S({queryKey:["reviewCards"+a],queryFn:async({pageParam:x})=>{const s=x*10,f=s+10,h=t.slice(s,f);if(h.length===0)return[];const w=await L.getReivewByIds(h);return console.log("reviewCards:",w),w},initialPageParam:0,getNextPageParam:(x,s)=>{const f=s.length,h=(t==null?void 0:t.length)||0;if(f*10<h)return f}});return g.useEffect(()=>{o&&d&&!l&&i()},[o,d,l,i]),N?e.jsx("div",{className:"font-notoTC w-screen flex justify-center items-center mt-4 fa-2x",children:e.jsx(m,{icon:y,spinPulse:!0,className:"flex justify-center items-center"})}):e.jsxs("div",{className:"font-notoTC flex flex-col items-center ",children:[n==null?void 0:n.pages.map(x=>x.map(s=>e.jsx(E,{name:s.userName,starNumber:s.rating,date:s.date,description:s.comment},s.id))),e.jsx("div",{ref:c,className:"my-5"}),d?e.jsx("div",{className:"flex justify-center items-center mt-4 fa-2x",children:e.jsx(m,{icon:y,spinPulse:!0})}):"No more reviews to show"]})};v.propTypes={reviewIdList:p.arrayOf(p.string).isRequired,merchantId:p.string.isRequired};const u=t=>{const{stars:a,percentage:r,count:c}=t;return e.jsxs("div",{className:"font-notoTC items-center mt-1 flex flex-row",children:[e.jsx("div",{className:"flex",children:[...Array(5)].map((o,n)=>e.jsx(m,{icon:j,className:n<a?"text-yellow-300":"text-gray-300"},n))}),e.jsx("div",{className:"w-full mr-31 bg-gray-200 rounded-full h-2.5 mx-2",children:e.jsx("div",{className:"bg-yellow-300 h-2.5 rounded-full",style:{width:`${r}%`}})}),e.jsxs("span",{className:"text-gray-700",children:["(",c,")"]})]})},A=10,D=15,M=40,B=20,F=15,O=2,_=3,k=8,q=4,Z=3,Q=()=>{const{merchantId:t}=P(),a=T(l=>l.getMerchantById),[r,c]=g.useState(null),[o,n]=g.useState([]),i=C(),d=()=>{i(-1)};return g.useEffect(()=>{const l=a(t);l?(c(l),n(l.reviewIdList)):(async()=>{var x;try{const s=await b.getMerchantsByIdList([t]);c(s.data[0]),n(((x=s.data[0])==null?void 0:x.reviewIdList)||null)}catch(s){console.error("Failed to fetch merchant data:",s)}})()},[t,a]),!r||!o?e.jsx("div",{className:"font-notoTC flex justify-center items-center mt-4 fa-2x",children:e.jsx(m,{icon:y,spinPulse:!0})}):e.jsx("div",{className:"overflow-y-auto font-notoTC fixed top-0 left-0 w-full h-full  bg-white flex flex-col justify-start items-start",children:e.jsxs("div",{className:"w-full mt-8",children:[e.jsx("div",{className:"absolute top-4 right-4",children:e.jsx("button",{className:"text-gray-500 hover:text-gray-700",onClick:d,children:e.jsx(m,{icon:I,className:"w-8 h-8"})})}),e.jsxs("div",{className:"title flex flex-col items-center",children:[e.jsxs("h2",{className:"text-xl font-bold text-black text-center",children:[r.name,"的評論"]}),e.jsxs("div",{className:"flex items-center mt-4 text-left",children:[e.jsx("span",{className:"text-3xl font-bold",children:Number(r.rating.toFixed(1))}),e.jsx(m,{icon:j,className:"text-yellow-300 ml-2 w-8 h-8"})]}),e.jsxs("div",{className:"mt-4 text-left w-3/4 max-w-md mx-5",children:[e.jsx(u,{stars:5,percentage:A,count:O}),e.jsx(u,{stars:4,percentage:D,count:_}),e.jsx(u,{stars:3,percentage:M,count:k}),e.jsx(u,{stars:2,percentage:B,count:q}),e.jsx(u,{stars:1,percentage:F,count:Z})]})]}),e.jsx(v,{reviewIdList:o,merchantId:t})]})})};export{Q as default};
